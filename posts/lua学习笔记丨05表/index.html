<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.136.5">

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon_32.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="" />
  <meta property="og:url" content="http://localhost:1313/posts/lua%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%A805%E8%A1%A8/" />
  <link rel="canonical" href="http://localhost:1313/posts/lua%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%A805%E8%A1%A8/" /><link rel="apple-touch-icon" href="/favicon.png" />
  <link rel="icon" href="/favicon.png" />
  <link rel="shortcut" href="/favicon.png" /><link rel="alternate" type="application/atom+xml" href="http://localhost:1313/index.xml" title="子春廿一">

  <script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "http:\/\/localhost:1313\/"
      },
      "articleSection" : "posts",
      "name" : "Lua学习笔记丨05表",
      "headline" : "Lua学习笔记丨05表",
      "description" : "表（Table）是Lua语言中最主要（事实上唯一）和强大的数据结构。使用表，Lua语言可以表示数组、集合、记录很很多其他数据结构。也可以使用表来表示包（package）和其他对象。当调用函数math.sin时，对于Lua来说，其实际含义是“以字符串\u0026quot;sin\u0026quot;为键检索表math“。\nLua语言中的表本质上是一种辅助数组（associative array），这种数组不仅可以用数值作为索引，也可以使用字符串或其他任意类型的值作为索引（nil除外）。\nLua语言中的表要么是值要么是变量，他们都是对象（object）。可以认为，表是一种动态分配的对象，程序只能操作指向表的引用（或指针）。除此以外，Lua不会进行隐藏的拷贝（深拷贝）或创建新的表。\n我们使用构造器表达式（constructor expression）创建表，其最简单的形式是{}：\na = {}\t-- 创建一个表然后用表的引用赋值\rk = \u0026#34;x\u0026#34;\ra[k] = 10\t-- 新元素，键是\u0026#34;x\u0026#34;，值是10\ra[20] = \u0026#34;great\u0026#34;\t-- 新元素，键是20，值是\u0026#34;great\u0026#34;\ra[\u0026#34;x\u0026#34;]\t--\u0026gt; 10\rk = 20\ra[k]\t--\u0026gt; \u0026#34;great\u0026#34;\ra[\u0026#34;x\u0026#34;] = a[\u0026#34;x\u0026#34;] \u002b 1\t-- 增加元素\u0026#34;x\u0026#34;的值\ra[\u0026#34;x\u0026#34;]\t--\u0026gt; 11 表永远是匿名的，表本身和保存表的变量之间没有固定的关系：\na = {}\ra[\u0026#34;x\u0026#34;] = 10\rb = a\t-- \u0026#39;b\u0026#39;和\u0026#39;a\u0026#39;引用同一张表 b[\u0026#34;x\u0026#34;]\t--\u0026gt; 10\rb[\u0026#34;x\u0026#34;] = 20\ra[\u0026#34;x\u0026#34;]\t--\u0026gt; 20\ra = nil\t--\u0026gt; 只有b仍然指向表\rb = nil\t--\u0026gt; 没有指向表的引用了 对于一个表而言，如果程序中不再有指向它的引用时，垃圾收集器会最终删除这个表并重用其内存。\n",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "2025",
      "datePublished": "2025-01-13 00:00:00 \u002b0000 UTC",
      "dateModified" : "2025-01-13 00:00:00 \u002b0000 UTC",
      "url" : "http:\/\/localhost:1313\/posts\/lua%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%A805%E8%A1%A8\/",
      "keywords" : [  ]
  }
</script>
<title>
    
    Lua学习笔记丨05表
  
  </title>
  <meta property="og:title" content="Lua学习笔记丨05表" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="表（Table）是Lua语言中最主要（事实上唯一）和强大的数据结构。使用表，Lua语言可以表示数组、集合、记录很很多其他数据结构。也可以使用表来表示包（package）和其他对象。当调用函数math.sin时，对于Lua来说，其实际含义是“以字符串&quot;sin&quot;为键检索表math“。
Lua语言中的表本质上是一种辅助数组（associative array），这种数组不仅可以用数值作为索引，也可以使用字符串或其他任意类型的值作为索引（nil除外）。
Lua语言中的表要么是值要么是变量，他们都是对象（object）。可以认为，表是一种动态分配的对象，程序只能操作指向表的引用（或指针）。除此以外，Lua不会进行隐藏的拷贝（深拷贝）或创建新的表。
我们使用构造器表达式（constructor expression）创建表，其最简单的形式是{}：
a = {}	-- 创建一个表然后用表的引用赋值k = &#34;x&#34;a[k] = 10	-- 新元素，键是&#34;x&#34;，值是10a[20] = &#34;great&#34;	-- 新元素，键是20，值是&#34;great&#34;a[&#34;x&#34;]	--&gt; 10k = 20a[k]	--&gt; &#34;great&#34;a[&#34;x&#34;] = a[&#34;x&#34;] &#43; 1	-- 增加元素&#34;x&#34;的值a[&#34;x&#34;]	--&gt; 11 表永远是匿名的，表本身和保存表的变量之间没有固定的关系：
a = {}a[&#34;x&#34;] = 10b = a	-- &#39;b&#39;和&#39;a&#39;引用同一张表 b[&#34;x&#34;]	--&gt; 10b[&#34;x&#34;] = 20a[&#34;x&#34;]	--&gt; 20a = nil	--&gt; 只有b仍然指向表b = nil	--&gt; 没有指向表的引用了 对于一个表而言，如果程序中不再有指向它的引用时，垃圾收集器会最终删除这个表并重用其内存。
" />
  <meta name="description" content="表（Table）是Lua语言中最主要（事实上唯一）和强大的数据结构。使用表，Lua语言可以表示数组、集合、记录很很多其他数据结构。也可以使用表来表示包（package）和其他对象。当调用函数math.sin时，对于Lua来说，其实际含义是“以字符串&quot;sin&quot;为键检索表math“。
Lua语言中的表本质上是一种辅助数组（associative array），这种数组不仅可以用数值作为索引，也可以使用字符串或其他任意类型的值作为索引（nil除外）。
Lua语言中的表要么是值要么是变量，他们都是对象（object）。可以认为，表是一种动态分配的对象，程序只能操作指向表的引用（或指针）。除此以外，Lua不会进行隐藏的拷贝（深拷贝）或创建新的表。
我们使用构造器表达式（constructor expression）创建表，其最简单的形式是{}：
a = {}	-- 创建一个表然后用表的引用赋值k = &#34;x&#34;a[k] = 10	-- 新元素，键是&#34;x&#34;，值是10a[20] = &#34;great&#34;	-- 新元素，键是20，值是&#34;great&#34;a[&#34;x&#34;]	--&gt; 10k = 20a[k]	--&gt; &#34;great&#34;a[&#34;x&#34;] = a[&#34;x&#34;] &#43; 1	-- 增加元素&#34;x&#34;的值a[&#34;x&#34;]	--&gt; 11 表永远是匿名的，表本身和保存表的变量之间没有固定的关系：
a = {}a[&#34;x&#34;] = 10b = a	-- &#39;b&#39;和&#39;a&#39;引用同一张表 b[&#34;x&#34;]	--&gt; 10b[&#34;x&#34;] = 20a[&#34;x&#34;]	--&gt; 20a = nil	--&gt; 只有b仍然指向表b = nil	--&gt; 没有指向表的引用了 对于一个表而言，如果程序中不再有指向它的引用时，垃圾收集器会最终删除这个表并重用其内存。
" />
  <meta property="og:locale" content="cn" /><meta property="og:image" content="/favicon.png" />
  

  
    <style>@import '/fonts/lxgw-wenkai-screen-webfont/style.css';body{font-family:lxgw wenkai screen,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none!important}a:hover{text-decoration:underline!important}table{width:100%;border-collapse:collapse;border:2px solid #000}th,td{text-align:center;vertical-align:middle;border:2px solid #000;padding:10px}p{}details{background-color:#f0f0f0;border:0 solid #1e90ff;border-radius:20px;padding:10px}details[open]{background-color:#f0f0f0}summary{font-size:20px;font-weight:700;color:#000;cursor:pointer;transition:color .3s ease}summary:hover{color:#ff4500}.highlight{position:relative}button{appearance:auto;text-rendering:auto;color:buttontext;letter-spacing:normal;word-spacing:normal;line-height:normal;text-transform:none;text-indent:0;text-shadow:none;display:inline-block;text-align:center;align-items:flex-start;cursor:default;box-sizing:border-box;background-color:buttonface;margin:0;padding-block:1px;padding-inline:6px;border-width:2px;border-style:outset;border-color:buttonborder;border-image:initial}.copy-button{display:none;position:absolute;top:10px;right:10px;padding:5px 10px;font-size:.8em;color:#fff;background-color:#008b8b;border:none;border-radius:4px;box-shadow:0 2px 5px rgba(0,0,0,.2);transition:background-color .3s ease}.copy-button:hover{background-color:#cd3bee}.highlight:hover .copy-button{display:inline-block}.post-ads{color:#00f;margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body blockquote{margin:0;padding:0 1em;color:#57606a;border-left:.25em solid #d0d7de}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:#f6f8fa;border-radius:6px}.markdown-body pre>code{padding:0;font-size:100%;background-color:inherit;border:0}.Chinese .markdown-body{line-height:200%}.header-main{display:flex;padding:5px 0;justify-content:flex-start}.header-avatar img{width:113px;height:125px;border-radius:50%;margin-right:10px}.site-date-catalog{font-family:lxgw wenkai screen,sans-serif;font-size:2rem;color:blue}.header-title{font-family:lxgw wenkai screen,sans-serif;font-size:2rem;font-weight:700;margin-top:32px}.header-title a{text-decoration:none}.header-subtitle{color:#c557a2;font-size:1.3rem;font-weight:700}.header-items{margin:5px 0}.header-item{margin:0 5px}.header-line{width:100%;border-width:2px;border-color:#482936;border-style:solid none none none}.header-content{display:flex;align-items:center}.lang-switch{font-weight:900}#posts-list{min-height:600px}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}pre{background-color:#f5f2f0;padding:5px;font-family:lxgw wenkai screen,sans-serif;font-size:18px;margin-bottom:18px margin-left:0px margin-right:0px margin-top:18px padding-top:16px padding-bottom:16px padding-left:16px padding-right:16px white-space:pre-wrap;word-wrap:break-word;overflow-x:auto;overflow-y:auto;-webkit-font-smoothing:antialiased}code{font-family:Consolas,Monaco,andale mono,ubuntu mono,monospace}.post-header{margin-bottom:50px;font-weight:900}.post-title{font-size:2rem;font-weight:900}.post-tags{display:inline;font-weight:900;padding:2px 5px;margin-right:6px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:900;font-style:italic}.post-author{float:right;font-weight:900}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.post-content img{max-width:100%;display:block;margin-right:auto;margin-top:6px}.post-content .post-gallery{display:flex;flex-wrap:wrap;gap:6px}.post-content .post-gallery img{margin-right:auto;margin-top:auto;width:calc(50% - 3px)}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}@media screen and (max-width:600px){.header-title,.header-subtitle,.header-items{}.posts-line{font-size:16px}.markdown-body{font-size:18px;max-width:100%}.post-title{font-size:2rem;font-weight:900}.post-content p{letter-spacing:.05em}.post-content .post-gallery img{width:100%}}@media screen and (max-width:48em){.posts-category{display:none}}.language-css.token.string,.style.token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:0 0!important}</style>
  
  
    <style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style>
  

  

  <link href="/index.xml" rel="alternate" type="application/rss+xml"
    title="子春廿一">
  
  

<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<script>
  function addDarkmodeWidget() {
    new Darkmode().showWidget();
  }
  window.addEventListener('load', addDarkmodeWidget);
</script>

  
  
</head>


<body>
  <article class="post Chinese" id="article">
    <div class="row">
      <div class="col-xs-12">
        <div class="site-header">
          
<header class="header-main">
	<div class="header-content">
		<div class="header-avatar">
		<img src="/%e5%a4%b4%e5%83%8f.jpg" />
		</div>
		<div class="header-title">
			<a href="/">子春廿一</a>
			<div class="header-subtitle">中意胡梓悦大王💖</div> 
		</div>
	</div>
</header>
<div class="row end-md header-items">
  
  <div class="header-item">
    <a href="/categories/index.html" >分类</a>
  </div>
  
</div>
<div class="row">
   
</div>
<div class="header-line"></div>

        </div>
        <header class="post-header">
          <h1 class="post-title">Lua学习笔记丨05表</h1>
          
          <div class="row post-desc">
            <div class="col-xs-6">
              
              <time class="post-date" datetime="2025-01-13 00:00:00 UTC">
                13 Jan 2025
              </time>
              
            </div>
            <div class="col-xs-6">
              
            </div>
          </div>
          
        </header>

        <div class="post-content markdown-body">
          
          <p>表（Table）是Lua语言中最主要（事实上唯一）和强大的数据结构。使用表，Lua语言可以表示数组、集合、记录很很多其他数据结构。也可以使用表来表示包（package）和其他对象。当调用函数math.sin时，对于Lua来说，其实际含义是“以字符串&quot;sin&quot;为键检索表math“。</p>
<p>Lua语言中的表本质上是一种辅助数组（associative array），这种数组不仅可以用数值作为索引，也可以使用字符串或其他任意类型的值作为索引（nil除外）。</p>
<p>Lua语言中的表要么是值要么是变量，他们都是对象（object）。可以认为，表是一种动态分配的对象，程序只能操作指向表的引用（或指针）。除此以外，Lua不会进行隐藏的拷贝（深拷贝）或创建新的表。</p>
<p>我们使用构造器表达式（constructor expression）创建表，其最简单的形式是{}：</p>
<pre tabindex="0"><code>a = {}				-- 创建一个表然后用表的引用赋值
k = &#34;x&#34;
a[k] = 10			-- 新元素，键是&#34;x&#34;，值是10
a[20] = &#34;great&#34;			-- 新元素，键是20，值是&#34;great&#34;
a[&#34;x&#34;]				--&gt; 10
k = 20
a[k]				--&gt; &#34;great&#34;
a[&#34;x&#34;] = a[&#34;x&#34;] + 1		-- 增加元素&#34;x&#34;的值
a[&#34;x&#34;]				--&gt; 11
</code></pre><p>表永远是匿名的，表本身和保存表的变量之间没有固定的关系：</p>
<pre tabindex="0"><code>a = {}
a[&#34;x&#34;] = 10
b = a		-- &#39;b&#39;和&#39;a&#39;引用同一张表                                     
b[&#34;x&#34;]		--&gt; 10
b[&#34;x&#34;] = 20
a[&#34;x&#34;]		--&gt; 20
a = nil		--&gt; 只有b仍然指向表
b = nil		--&gt; 没有指向表的引用了
</code></pre><p>对于一个表而言，如果程序中不再有指向它的引用时，垃圾收集器会最终删除这个表并重用其内存。</p>
<h2 id="51-表索引">5.1 表索引</h2>
<p>同一个表中存储的值可以有不同的类型索引，并可以按需增长以容纳新的元素：</p>
<pre tabindex="0"><code>a = {}		-- 空的表
-- 创建1000个新元素
for i = 1, 1000 do a[i] = i * 2 end
a[9]		--&gt; 18
a[&#34;x&#34;] = 10
a[&#34;x&#34;]		--&gt; 10
a[&#34;y&#34;]		--&gt; nil
</code></pre><p>注意上述代码最后一行：如同全局变量一样，未经初始化的表元素为nil，将nil赋值给表元素可以将其删除。这并非巧合，因为Lua语言实际上就是用表来存储全局变量的。</p>
<p>当把表当作结构体使用时，可以把索引当作成员名称使用（a.name等价于a[&ldquo;name&rdquo;]）。因此，可以使用这种方式改写前述示例的最后几行：</p>
<pre tabindex="0"><code>a = {}				-- 空白表
a.x = 10			-- 等价于a[&#34;x&#34;] = 10
a.x		--&gt; 10		-- 等价于a[&#34;x&#34;]
a.y		--&gt; nil		-- 等价于a[&#34;y&#34;]
</code></pre><p>对Lua语言来说，这两种形式是等价且可以混用的，不过对于阅读来说，他们可能代表了不同的意图。比如a.name表示这个表是被当作结构体使用的，此时表实际上是由固定的、预先定义的键组成的集合；而a[&ldquo;name&rdquo;]说明表可以使用任意字符串作为键，并且出于某种原因我们操作的是指定的键。</p>
<p>a.x和a[x]是不同的。实际上，a[x]是指由变量x对应的值索引的表，例如：</p>
<pre tabindex="0"><code>a = {}
x = &#34;y&#34;
a[x] = 10			-- 把10放在字段&#34;y&#34;中
a[x]		--&gt; 10		-- 字段&#34;y&#34;的值
a.x		--&gt; nil		-- 字段&#34;x&#34;的值
a.y		--&gt; 10		-- 字段&#34;y&#34;的值
</code></pre><p>由于可以使用任意类型索引表。当不能确定表索引的真实数据类型时，可以使用显示的类型转换：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>; j <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10&#34;</span>; k <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;+10&#34;</span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>a[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;number key&#34;</span>
</span></span><span style="display:flex;"><span>a[j] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;string key&#34;</span>
</span></span><span style="display:flex;"><span>a[k] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;another string key&#34;</span>
</span></span><span style="display:flex;"><span>a[tonumber(j)]		<span style="color:#75715e">--&gt; number key</span>
</span></span><span style="display:flex;"><span>a[tonumber(k)]		<span style="color:#75715e">--&gt; number key</span>
</span></span></code></pre></div><p>若不注意这一点，就很容易引起bug。整型和浮点型的表索引不存在上述问题。例如2和2.0的值相等，当它们被用作表索引使用时指向同一个表元素。</p>
<p>更准确地说，任何能够被转换为整型的浮点数都会被u转换成整型值。而不能被转换成整型的浮点数则不会发生上述的类型转换。</p>
<h2 id="52-表构造器">5.2 表构造器</h2>
<p>表构造器是用来创建和初始化的表达式，是Lua中独特的也是最有用、最灵活的机制之一。</p>
<p>简单的构造器是空构造器{}。表构造器也可以用来初始化列表（构造器第一个元素的索引是1不是0）：</p>
<pre tabindex="0"><code>days = {&#34;Sunday&#34;, &#34;Monday&#34;, &#34;Tuesday&#34;, &#34;Wednesday&#34;, &#34;Thursday&#34;, &#34;Friday&#34;, &#34;Saturday&#34;}
print(day[4])		--&gt; Wednesday
</code></pre><p>Lua还提供了一种初始化记录式（record-like）表的特殊语法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> {x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>}
</span></span></code></pre></div><p>上述代码等价于：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> {}; a.x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>; a.y <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span></code></pre></div><p>不过，在第一种写法中，由于能够提前判断表的大小，所以运行速度更快。</p>
<p>无论使用哪种方式创建表，都可以随时增加或删除表元素：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>w <span style="color:#f92672">=</span> {x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;console&#34;</span>}
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> {math.sin(<span style="color:#ae81ff">0</span>), math.sin(<span style="color:#ae81ff">1</span>), math.sin(<span style="color:#ae81ff">2</span>)}
</span></span><span style="display:flex;"><span>w[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;another field&#34;</span>		<span style="color:#75715e">-- 把键1增加到表&#39;w&#39;中</span>
</span></span><span style="display:flex;"><span>x.f <span style="color:#f92672">=</span> w						<span style="color:#75715e">-- 把键&#34;f&#34;增加到表&#39;x&#39;中</span>
</span></span><span style="display:flex;"><span>print(w[<span style="color:#e6db74">&#34;x&#34;</span>])				<span style="color:#75715e">--&gt; 0</span>
</span></span><span style="display:flex;"><span>print(w[<span style="color:#ae81ff">1</span>])					<span style="color:#75715e">--&gt; another field</span>
</span></span><span style="display:flex;"><span>print(x.f[<span style="color:#ae81ff">1</span>])				<span style="color:#75715e">--&gt; another field</span>
</span></span><span style="display:flex;"><span>w.x <span style="color:#f92672">=</span> <span style="color:#66d9ef">nil</span>					<span style="color:#75715e">-- 删除字段&#34;x&#34;</span>
</span></span></code></pre></div><p>在同一个构造器中，可以混用记录式（record-style）和列表式（list-style）写法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>polyline <span style="color:#f92672">=</span> {color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>,
</span></span><span style="display:flex;"><span>			thickness <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>    		npoints <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>    		{x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>},		<span style="color:#75715e">-- polyline[1]</span>
</span></span><span style="display:flex;"><span>    		{x <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>},	<span style="color:#75715e">-- polyline[2]</span>
</span></span><span style="display:flex;"><span>    		{x <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},	<span style="color:#75715e">-- polyline[3]</span>
</span></span><span style="display:flex;"><span>        	{x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},		<span style="color:#75715e">-- polyline[4]</span>
</span></span><span style="display:flex;"><span>		   }
</span></span></code></pre></div><p>上述的示例也同时展示了如何嵌套表（和构造器）以表达更复杂的数据结构。每一个元素polyline[i]都是代表一条记录的表：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>print(polyline[<span style="color:#ae81ff">2</span>].x)		<span style="color:#75715e">--&gt; -10</span>
</span></span><span style="display:flex;"><span>print(polyline[<span style="color:#ae81ff">4</span>].y)		<span style="color:#75715e">--&gt; 1</span>
</span></span></code></pre></div><p>不过，这两种表都有局限。索引必须以1作为开始初始化表元素，也不能使用不符合规范的标识符作为索引。对于这类需求，可以使用另一种更加通用的构造器，即通过方括号括起来的表达式显示地指定每一个索引：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>opnames <span style="color:#f92672">=</span> {[<span style="color:#e6db74">&#34;+&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;add&#34;</span>, [<span style="color:#e6db74">&#34;-&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sub&#34;</span>,
</span></span><span style="display:flex;"><span>		   [<span style="color:#e6db74">&#34;*&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mul&#34;</span>, [<span style="color:#e6db74">&#34;/&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;div&#34;</span>}
</span></span><span style="display:flex;"><span>		   
</span></span><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>; s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;-&#34;</span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> {[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> s, [i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> s<span style="color:#f92672">..</span>s, [i <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> s<span style="color:#f92672">..</span>s<span style="color:#f92672">..</span>s}
</span></span><span style="display:flex;"><span>print(opnames[s])		<span style="color:#75715e">--&gt; sub</span>
</span></span><span style="display:flex;"><span>print(a[<span style="color:#ae81ff">22</span>])			<span style="color:#75715e">--&gt; ---</span>
</span></span></code></pre></div><p>这里说的是，可以利用方括号来避免另外两种不使用方括号带来的限制：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>; s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;-&#34;</span>
</span></span><span style="display:flex;"><span>polyline <span style="color:#f92672">=</span> {[<span style="color:#ae81ff">22</span>] <span style="color:#f92672">=</span> {[<span style="color:#e6db74">&#34;+&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;add&#34;</span>, [<span style="color:#e6db74">&#34;-&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sub&#34;</span>,
</span></span><span style="display:flex;"><span>		   [<span style="color:#e6db74">&#34;*&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mul&#34;</span>, [<span style="color:#e6db74">&#34;/&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;div&#34;</span>},
</span></span><span style="display:flex;"><span>		   {[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> s, [i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> s<span style="color:#f92672">..</span>s, [i <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> s<span style="color:#f92672">..</span>s<span style="color:#f92672">..</span>s}
</span></span><span style="display:flex;"><span>		   }
</span></span><span style="display:flex;"><span>print(polyline[<span style="color:#ae81ff">22</span>][<span style="color:#e6db74">&#34;+&#34;</span>])		<span style="color:#75715e">--&gt; add</span>
</span></span><span style="display:flex;"><span>print(polyline[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">22</span>])			<span style="color:#75715e">--&gt; ---</span>
</span></span></code></pre></div><p>这种构造器虽然冗长，但却非常灵活，另外两种都是其特殊形式。例如，下列几种表达式等价：</p>
<p>{x = 0, y = 0}		&lt;&ndash;&gt;		{[&ldquo;x&rdquo;] = 0, [&ldquo;y&rdquo;] = 0}</p>
<p>{&ldquo;r&rdquo;, &ldquo;g&rdquo;, &ldquo;b&rdquo;}		&lt;&ndash;&gt;		{[1] = &ldquo;r&rdquo;, [2] = &ldquo;g&rdquo;, [3] = &ldquo;b&rdquo;}</p>
<p>在最后一个元素后可以紧跟一个逗号，也可以不加，是可选的。且逗号也可以用分号代替，这主要是为了兼容Lua语言的旧版本。</p>
<h2 id="53-数组列表和序列">5.3 数组、列表和序列</h2>
<p>若想表示数组或列表，只需要用整型作为索引的表即可。同时，也不需要预先声明表的大小，只需要直接初始化需要的元素即可：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#75715e">-- 读取10行，然后保存在一个表内</span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	a[i] <span style="color:#f92672">=</span> io.read()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>由于能够使用任意值对表进行索引，我们也可以使用任意数字作为第一个元素的索引。不过，在Lua中，数组索引惯例是从1开始，并且Lua中其他很多机制也遵循这个惯例。</p>
<p>当操作列表时，往往必须事先获取列表的长度。该长度可以存放在常量中，也可以存放在其他变量或数据结构中。通常，我们把列表的长度放在表中某个非数值类型的字段中（由于历史原因，该键通常是&quot;n&quot;）。当然，列表的长度经常也是隐式的。另外，由于未初始化的元素均为nil，所以可以利用nil值来标记列表的结束。这种技巧只有在列表不存在空洞时（即所有元素均不为nil）才有效，此时我们把这种所有元素都不为nil的数组称为序列（sequence）（由指定的n个连续正数数值类型的键所形成的表）。</p>
<p>Lua语言提供了获取序列长度的操作符#。正如我们之前所看到的，对于字符串而言，该操作符返回字符串的字节数，对于表而言，该操作符返回表对应序列的长度。例如，可以使用如下的代码输出上述中读入的内容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#75715e">-- 输出行，从1到#a</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#f92672">#</span>a <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	print(a[i])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>长度操作符也为操作序列提供了几种有用的写法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>print(a[<span style="color:#f92672">#</span>a])		<span style="color:#75715e">-- 输出序列&#39;a&#39;的最后一个值</span>
</span></span><span style="display:flex;"><span>a[<span style="color:#f92672">#</span>a] <span style="color:#f92672">=</span> <span style="color:#66d9ef">nil</span>			<span style="color:#75715e">-- 移除最后一个值</span>
</span></span><span style="display:flex;"><span>a[<span style="color:#f92672">#</span>a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> v		<span style="color:#75715e">-- 把&#39;v&#39;加到序列的最后</span>
</span></span></code></pre></div><p>对于中间存在空洞（nil值）的列表而言，序列长度操作符是不可靠的。因此，在存在各种争议的情况下，在确实需要处理存在空洞的列表时，应该显式地将列表的长度保存起来。</p>
<h2 id="54-遍历表">5.4 遍历表</h2>
<p>我们可以使用pairs迭代器遍历表中的键值对：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>t <span style="color:#f92672">=</span> {<span style="color:#ae81ff">10</span>, print, x <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>, k <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hi&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> k, v <span style="color:#66d9ef">in</span> pairs(t) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	print(k, v)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; 1	10</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; 2	function: 0000000065b9cff0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; x	12</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; k	hi</span>
</span></span></code></pre></div><p>受限于表在Lua语言中的底层实现机制，遍历过程中元素的出现顺序可能是随机的，相同的程序在每次运行时也可能产生不同的顺序。唯一确定的是每个元素在遍历过程中会且只会出现一次。（经过我在5.4的实验，默认键值对的10和print是按照表中顺序固定在前面的）</p>
<p>对于列表而言，可以使用ipairs迭代器：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>t <span style="color:#f92672">=</span> {<span style="color:#ae81ff">10</span>, print, <span style="color:#ae81ff">12</span>, <span style="color:#e6db74">&#34;hi&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> k, v <span style="color:#66d9ef">in</span> ipairs(t) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	print(k, v)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; 1	10</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; 2	function: 0000000065b9cff0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; 3	12</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; 4	hi</span>
</span></span></code></pre></div><p>此时，Lua会确保遍历是按照顺序进行的。</p>
<p>另一种遍历序列的方法是使用数值型for循环：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>t <span style="color:#f92672">=</span> {<span style="color:#ae81ff">10</span>, print, <span style="color:#ae81ff">12</span>, <span style="color:#e6db74">&#34;hi&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#f92672">#</span>t <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	print(i, t[i])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; 1	10</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; 2	function: 0000000065b9cff0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; 3	12</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">--&gt; 4	hi</span>
</span></span></code></pre></div><h2 id="55-安全访问">5.5 安全访问</h2>
<p>考虑到如下情景：我们想确认在指定的库中是否存在某一个函数。如果我们确定这个库确实存在，那么可以直接使用if lib.foo then &hellip;；否则，就得使用形如if lib and lib.foo then &hellip;的表达式。</p>
<p>当表的嵌套变得比较深时，这种写法就很容易出错，例如：</p>
<pre tabindex="0"><code>zip = company and company.director and
		company.directory.address and
		company.directory.address.zipcode
</code></pre><p>这种写法不仅冗长而且低效，该写法在一次成功的访问者对表进行了6此访问而非3次访问。</p>
<p>对于这种情景，在C#中我们可以使用一种安全访问操作符”?.“。例如，对于表达式a?.b，当a为nil时，其结果是nil而不会产生异常。使用这种操作符，可以将上例改写为：</p>
<pre tabindex="0"><code>zip = company?.director?.address?.zipcode
</code></pre><p>如果上述的成员访问过程中出现nil，安全访问操作符也会正确处理nil并最终返回nil。</p>
<p>但是，Lua没有提供这种操作符，不过我们可以使用其他语句来模拟安全访问操作符。</p>
<p>对于表达式a or {}，当a为nil时其结果是一个空表。因此，对于表达式(a or {}).b，当a为nil时其结果也是nil。这样，在Lua中我们可以将之前的例子改写为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>zip <span style="color:#f92672">=</span> (((company <span style="color:#f92672">or</span> {}).directory <span style="color:#f92672">or</span> {}).address <span style="color:#f92672">or</span> {}).zipcode
</span></span></code></pre></div><p>再进一步，我们还可以写的更短和更高效：</p>
<pre tabindex="0"><code>E =  {}		-- 可以在其他类似表达式中复用
...
zip = (((company or E).directory or E).address or E).zipcode
</code></pre><p>虽然不如安全访问操作符简单，但是表中的每一个字段名都只被使用了一次，保证了尽可能少地对表进行访问。</p>
<h2 id="56-表标准库">5.6 表标准库</h2>
<p>函数table.insert向序列的指定位置插入一个元素，其他元素依次后移。例如，对于列表t = {10, 20, 30}，在调用table.insert(t, 1, 15)后它会变成{15, 10, 20, 30}，另一种特殊但常见地情况是调用insert但不指定位置，此时该函数会在序列的最后插入指定地元素，而不会移动任何元素。</p>
<p>函数table.remove删除并返回序列指定位置的元素，然后将其后的元素向前移动填充删除元素后造成的空洞。如果在调用该函数时不指定位置，该函数会删除序列的最后一个元素。</p>
<p>借助这两个函数，可以很容易地实现栈、队列和双端队列。</p>
<p>Lua5.3对于移动表中的元素引入了一个更通用的函数table. move(a, f, e, t)，调用该函数可以将表a从索引f到e的元素（闭区间）移动到位置t上。例如，如下代码可以在列表a的开头插入一个元素：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>table.move(a, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">#</span>a, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>a[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> newElement
</span></span></code></pre></div><p>如下的代码可以删除第一个元素：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>table.move(a, <span style="color:#ae81ff">2</span>, <span style="color:#f92672">#</span>a, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>a[<span style="color:#f92672">#</span>a] <span style="color:#f92672">=</span> <span style="color:#66d9ef">nil</span>
</span></span></code></pre></div><p>在计算机领域，移动实际上是将一个值从一个地方拷贝的另一个地方，所以在上例中，我们要显示地将最后一个元素删除。</p>
<p>函数table.move还支持使用一个表作为可选的参数。当带有可选的表作为参数时，该函数将第一个表中的元素移动到第二个表中。例如，table.move(a, 1, #a, 1,  {})返回列表a的一个克隆，table.move(a, 1, #a, #b + 1, b)将列表a中的所有元素复制到列表b的末尾。</p>
<h2 id="57-练习">5.7 练习</h2>
<p>在后续写练习的时候，发现#操作符在lua5.4可能发生了变化？</p>
<pre tabindex="0"><code>local tab1 = {}
tab1[1] = 1
tab1[2] = 1
tab1[4] = 1
tab1[8] = 1

local tab2 ={
[1]=1,
[2]=1,
[4]=1,
[8]=1
}

print(#tab1)--out4
print(#tab2)--out8
	--&gt; 4
	--&gt; 8
</code></pre><p>看到这个例子让我更加疑惑，后来在<a style="color: #0000FF;" href="https://zhuanlan.zhihu.com/p/406854189" target="_blank">What&rsquo;s new in Lua 5.4</a>下，知道了原因。</p>
<p>Lua 5.4以前，#操作符的效率不是很高，因此在5.4中提升了#操作符的速度。首先，我们要明确#table的定义，#返回table的边界，边界可能是：</p>
<ul>
<li>一个表索引：这个索引的元素不为nil，且下一个元素为nil</li>
<li>0: 第1个元素为nil的情况</li>
</ul>
<p>Lua5.3为了寻找数组部分的边界，用二分查找的方式，花费的时间是O(log n)。Lua5.4也会用到二分查找，但它为一些常见的操作进行了优化，Table结构引入alimit这个字段用于猜测数组部分的边界，取长度时只要判断t[alimit+1]为nil就表示alimit为表的边界，如此一来就不必进行二分查找了，所以我们在做向序列增加元素这种操作时，效率会得到大大的提高。</p>
<p>（虽然这里可能并不是5.4更新带来的，但是让我更了解到#的机制）</p>

        </div>

        <div class="row middle-xs">
          <div class="col-xs-12">
            
          </div>
        </div>
        
          <div class="row">
            <div class="col-xs-12">
              
            </div>
          </div>

          



          
          
          <div style="height: 50px;"></div>
          
          <div class="post-comments">
            <div id="disqus_thread"></div>
<script>
  window.addEventListener("load", () => {
    (function() {
      
      var d = document,
        s = d.createElement("script");
      s.src = "https://dongi30.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  });
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>

          </div>
          
        

        <div class="site-footer">
  
  
</div>

      </div>
    </div>
  </article>

  

<script>
  
  
    
    
  
</script>

  

</body>

</html>