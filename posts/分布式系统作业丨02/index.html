<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.136.5">

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon_32.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="" />
  <meta property="og:url" content="http://localhost:1313/posts/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%BD%9C%E4%B8%9A%E4%B8%A802/" />
  <link rel="canonical" href="http://localhost:1313/posts/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%BD%9C%E4%B8%9A%E4%B8%A802/" /><link rel="apple-touch-icon" href="/favicon.png" />
  <link rel="icon" href="/favicon.png" />
  <link rel="shortcut" href="/favicon.png" /><link rel="alternate" type="application/atom+xml" href="http://localhost:1313/index.xml" title="å­æ˜¥å»¿ä¸€">

  <script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "http:\/\/localhost:1313\/"
      },
      "articleSection" : "posts",
      "name" : "åˆ†å¸ƒå¼ç³»ç»Ÿä½œä¸šä¸¨02",
      "headline" : "åˆ†å¸ƒå¼ç³»ç»Ÿä½œä¸šä¸¨02",
      "description" : " ä½œä¸šåœ°å€\nç¯å¢ƒæ­å»º è™šæ‹Ÿæœº Ubuntu-22.04.1 Go 1.23.4 GO ä¸‹è½½åœ°å€\nç¬¬ä¸€æ¬¡æ¥è§¦ Go è¯­è¨€è¿˜æ˜¯è¸©äº†ä¸€äº›å‘çš„ï¼Œå› ä¸ºçœ‹åˆ°è€å¸ˆç»™å‡ºçš„ ppt è¦æ±‚åœ¨1.5ä»¥ä¸Šï¼Œå°±ä¸‹è½½äº†æœ€æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºå¢™çš„åŸå› ï¼Œæˆ‘çš„ Ubuntu ä¸èƒ½ç›´æ¥ä¸‹è½½ï¼Œæ‰€ä»¥ç”¨WinSCP ä¼ åˆ°æˆ‘çš„ Ubuntu é‡Œé¢å»ï¼Œæ¥ç€åœ¨bç«™æœç´¢äº†ä¸€ä¸ªéƒ¨ç½²ç¯å¢ƒçš„æ•™ç¨‹ã€‚ï¼ˆè™½ç„¶ä¸€å¼€å§‹é”™å®‰è£…æˆ32ä½çš„äº†ï¼Œå¯¼è‡´åç»­å®‰è£…å…¶ä»– package çš„æ—¶å€™ä¼šå’Œ gcc çš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼‰ç„¶åæˆ‘å‘ç°æˆ‘ç…§ç€ PPT ä¸Šçš„æŒ‡ä»¤å»åšï¼Œå§‹ç»ˆä¸è¡Œã€‚æˆ‘çœ‹ç€æŠ¥é”™çš„å†…å®¹çªç„¶æƒ³èµ·äº†ä¹‹å‰çœ‹åˆ°åŒå­¦åœ¨ç¾¤é‡Œé—²èŠåˆ°è¿™ä¸ªä½œä¸šçš„æ—¶å€™çš„å†…å®¹ï¼Œå’Œ GO çš„ä¸åŒç‰ˆæœ¬çš„ç¯å¢ƒé…ç½®æœ‰å…³ï¼Œå½“æ—¶è§‰å¾—å¯èƒ½æœ‰ç”¨å°±é¡ºæ‰‹æ”¶è—äº†ï¼Œäºæ˜¯æˆ‘ç¿»å‡ºæ”¶è—çš„å†…å®¹ï¼Œè¾“å…¥æŒ‡ä»¤ export GO111MODULE=off æœç„¶å¥½ä½¿ã€‚\nAssignment Part I ä»»åŠ¡è¦æ±‚ Implement Raft by adding code to raft\/raft.go (only)\nâ€“ find some example code of how to send and receive RPC\nYour task: Leader election:\nâ€“ First task is to fill the RequestVoteArgs and RequestVoteReply structs\n",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "2024",
      "datePublished": "2024-12-16 00:00:00 \u002b0000 UTC",
      "dateModified" : "2024-12-16 00:00:00 \u002b0000 UTC",
      "url" : "http:\/\/localhost:1313\/posts\/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%BD%9C%E4%B8%9A%E4%B8%A802\/",
      "keywords" : [  ]
  }
</script>
<title>
    
    åˆ†å¸ƒå¼ç³»ç»Ÿä½œä¸šä¸¨02
  
  </title>
  <meta property="og:title" content="åˆ†å¸ƒå¼ç³»ç»Ÿä½œä¸šä¸¨02" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content=" ä½œä¸šåœ°å€
ç¯å¢ƒæ­å»º è™šæ‹Ÿæœº Ubuntu-22.04.1 Go 1.23.4 GO ä¸‹è½½åœ°å€
ç¬¬ä¸€æ¬¡æ¥è§¦ Go è¯­è¨€è¿˜æ˜¯è¸©äº†ä¸€äº›å‘çš„ï¼Œå› ä¸ºçœ‹åˆ°è€å¸ˆç»™å‡ºçš„ ppt è¦æ±‚åœ¨1.5ä»¥ä¸Šï¼Œå°±ä¸‹è½½äº†æœ€æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºå¢™çš„åŸå› ï¼Œæˆ‘çš„ Ubuntu ä¸èƒ½ç›´æ¥ä¸‹è½½ï¼Œæ‰€ä»¥ç”¨WinSCP ä¼ åˆ°æˆ‘çš„ Ubuntu é‡Œé¢å»ï¼Œæ¥ç€åœ¨bç«™æœç´¢äº†ä¸€ä¸ªéƒ¨ç½²ç¯å¢ƒçš„æ•™ç¨‹ã€‚ï¼ˆè™½ç„¶ä¸€å¼€å§‹é”™å®‰è£…æˆ32ä½çš„äº†ï¼Œå¯¼è‡´åç»­å®‰è£…å…¶ä»– package çš„æ—¶å€™ä¼šå’Œ gcc çš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼‰ç„¶åæˆ‘å‘ç°æˆ‘ç…§ç€ PPT ä¸Šçš„æŒ‡ä»¤å»åšï¼Œå§‹ç»ˆä¸è¡Œã€‚æˆ‘çœ‹ç€æŠ¥é”™çš„å†…å®¹çªç„¶æƒ³èµ·äº†ä¹‹å‰çœ‹åˆ°åŒå­¦åœ¨ç¾¤é‡Œé—²èŠåˆ°è¿™ä¸ªä½œä¸šçš„æ—¶å€™çš„å†…å®¹ï¼Œå’Œ GO çš„ä¸åŒç‰ˆæœ¬çš„ç¯å¢ƒé…ç½®æœ‰å…³ï¼Œå½“æ—¶è§‰å¾—å¯èƒ½æœ‰ç”¨å°±é¡ºæ‰‹æ”¶è—äº†ï¼Œäºæ˜¯æˆ‘ç¿»å‡ºæ”¶è—çš„å†…å®¹ï¼Œè¾“å…¥æŒ‡ä»¤ export GO111MODULE=off æœç„¶å¥½ä½¿ã€‚
Assignment Part I ä»»åŠ¡è¦æ±‚ Implement Raft by adding code to raft/raft.go (only)
â€“ find some example code of how to send and receive RPC
Your task: Leader election:
â€“ First task is to fill the RequestVoteArgs and RequestVoteReply structs
" />
  <meta name="description" content=" ä½œä¸šåœ°å€
ç¯å¢ƒæ­å»º è™šæ‹Ÿæœº Ubuntu-22.04.1 Go 1.23.4 GO ä¸‹è½½åœ°å€
ç¬¬ä¸€æ¬¡æ¥è§¦ Go è¯­è¨€è¿˜æ˜¯è¸©äº†ä¸€äº›å‘çš„ï¼Œå› ä¸ºçœ‹åˆ°è€å¸ˆç»™å‡ºçš„ ppt è¦æ±‚åœ¨1.5ä»¥ä¸Šï¼Œå°±ä¸‹è½½äº†æœ€æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºå¢™çš„åŸå› ï¼Œæˆ‘çš„ Ubuntu ä¸èƒ½ç›´æ¥ä¸‹è½½ï¼Œæ‰€ä»¥ç”¨WinSCP ä¼ åˆ°æˆ‘çš„ Ubuntu é‡Œé¢å»ï¼Œæ¥ç€åœ¨bç«™æœç´¢äº†ä¸€ä¸ªéƒ¨ç½²ç¯å¢ƒçš„æ•™ç¨‹ã€‚ï¼ˆè™½ç„¶ä¸€å¼€å§‹é”™å®‰è£…æˆ32ä½çš„äº†ï¼Œå¯¼è‡´åç»­å®‰è£…å…¶ä»– package çš„æ—¶å€™ä¼šå’Œ gcc çš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼‰ç„¶åæˆ‘å‘ç°æˆ‘ç…§ç€ PPT ä¸Šçš„æŒ‡ä»¤å»åšï¼Œå§‹ç»ˆä¸è¡Œã€‚æˆ‘çœ‹ç€æŠ¥é”™çš„å†…å®¹çªç„¶æƒ³èµ·äº†ä¹‹å‰çœ‹åˆ°åŒå­¦åœ¨ç¾¤é‡Œé—²èŠåˆ°è¿™ä¸ªä½œä¸šçš„æ—¶å€™çš„å†…å®¹ï¼Œå’Œ GO çš„ä¸åŒç‰ˆæœ¬çš„ç¯å¢ƒé…ç½®æœ‰å…³ï¼Œå½“æ—¶è§‰å¾—å¯èƒ½æœ‰ç”¨å°±é¡ºæ‰‹æ”¶è—äº†ï¼Œäºæ˜¯æˆ‘ç¿»å‡ºæ”¶è—çš„å†…å®¹ï¼Œè¾“å…¥æŒ‡ä»¤ export GO111MODULE=off æœç„¶å¥½ä½¿ã€‚
Assignment Part I ä»»åŠ¡è¦æ±‚ Implement Raft by adding code to raft/raft.go (only)
â€“ find some example code of how to send and receive RPC
Your task: Leader election:
â€“ First task is to fill the RequestVoteArgs and RequestVoteReply structs
" />
  <meta property="og:locale" content="cn" /><meta property="og:image" content="/favicon.png" />
  

  
    <style>@import '/fonts/lxgw-wenkai-screen-webfont/style.css';body{font-family:lxgw wenkai screen,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none!important}a:hover{text-decoration:underline!important}table{width:100%;border-collapse:collapse;border:2px solid #000}th,td{text-align:center;vertical-align:middle;border:2px solid #000;padding:10px}p{}details{background-color:#f0f0f0;border:0 solid #1e90ff;border-radius:20px;padding:10px}details[open]{background-color:#f0f0f0}summary{font-size:20px;font-weight:700;color:#000;cursor:pointer;transition:color .3s ease}summary:hover{color:#ff4500}.highlight{position:relative}button{appearance:auto;text-rendering:auto;color:buttontext;letter-spacing:normal;word-spacing:normal;line-height:normal;text-transform:none;text-indent:0;text-shadow:none;display:inline-block;text-align:center;align-items:flex-start;cursor:default;box-sizing:border-box;background-color:buttonface;margin:0;padding-block:1px;padding-inline:6px;border-width:2px;border-style:outset;border-color:buttonborder;border-image:initial}.copy-button{display:none;position:absolute;top:10px;right:10px;padding:5px 10px;font-size:.8em;color:#fff;background-color:#008b8b;border:none;border-radius:4px;box-shadow:0 2px 5px rgba(0,0,0,.2);transition:background-color .3s ease}.copy-button:hover{background-color:#cd3bee}.highlight:hover .copy-button{display:inline-block}.post-ads{color:#00f;margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body blockquote{margin:0;padding:0 1em;color:#57606a;border-left:.25em solid #d0d7de}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:#f6f8fa;border-radius:6px}.markdown-body pre>code{padding:0;font-size:100%;background-color:inherit;border:0}.Chinese .markdown-body{line-height:200%}.header-main{display:flex;padding:5px 0;justify-content:flex-start}.header-avatar img{width:113px;height:125px;border-radius:50%;margin-right:10px}.site-date-catalog{font-family:lxgw wenkai screen,sans-serif;font-size:2rem;color:blue}.header-title{font-family:lxgw wenkai screen,sans-serif;font-size:2rem;font-weight:700;margin-top:32px}.header-title a{text-decoration:none}.header-subtitle{color:#c557a2;font-size:1.3rem;font-weight:700}.header-items{margin:5px 0}.header-item{margin:0 5px}.header-line{width:100%;border-width:2px;border-color:#482936;border-style:solid none none none}.header-content{display:flex;align-items:center}.lang-switch{font-weight:900}#posts-list{min-height:600px}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}pre{background-color:#f5f2f0;padding:5px;font-family:lxgw wenkai screen,sans-serif;font-size:18px;margin-bottom:18px margin-left:0px margin-right:0px margin-top:18px padding-top:16px padding-bottom:16px padding-left:16px padding-right:16px white-space:pre-wrap;word-wrap:break-word;overflow-x:auto;overflow-y:auto;-webkit-font-smoothing:antialiased}code{font-family:Consolas,Monaco,andale mono,ubuntu mono,monospace}.post-header{margin-bottom:50px;font-weight:900}.post-title{font-size:2rem;font-weight:900}.post-tags{display:inline;font-weight:900;padding:2px 5px;margin-right:6px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:900;font-style:italic}.post-author{float:right;font-weight:900}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.post-content img{max-width:100%;display:block;margin-right:auto;margin-top:6px}.post-content .post-gallery{display:flex;flex-wrap:wrap;gap:6px}.post-content .post-gallery img{margin-right:auto;margin-top:auto;width:calc(50% - 3px)}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}@media screen and (max-width:600px){.header-title,.header-subtitle,.header-items{}.posts-line{font-size:16px}.markdown-body{font-size:18px;max-width:100%}.post-title{font-size:2rem;font-weight:900}.post-content p{letter-spacing:.05em}.post-content .post-gallery img{width:100%}}@media screen and (max-width:48em){.posts-category{display:none}}.language-css.token.string,.style.token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:0 0!important}</style>
  
  
    <style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style>
  

  

  <link href="/index.xml" rel="alternate" type="application/rss+xml"
    title="å­æ˜¥å»¿ä¸€">
  
  

<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<script>
  function addDarkmodeWidget() {
    new Darkmode().showWidget();
  }
  window.addEventListener('load', addDarkmodeWidget);
</script>

  
  
</head>


<body>
  <article class="post Chinese" id="article">
    <div class="row">
      <div class="col-xs-12">
        <div class="site-header">
          
<header class="header-main">
	<div class="header-content">
		<div class="header-avatar">
		<img src="/%e5%a4%b4%e5%83%8f.jpg" />
		</div>
		<div class="header-title">
			<a href="/">å­æ˜¥å»¿ä¸€</a>
			<div class="header-subtitle">ä¸­æ„èƒ¡æ¢“æ‚¦å¤§ç‹ğŸ’–</div> 
		</div>
	</div>
</header>
<div class="row end-md header-items">
  
  <div class="header-item">
    <a href="/categories/index.html" >åˆ†ç±»</a>
  </div>
  
</div>
<div class="row">
   
</div>
<div class="header-line"></div>

        </div>
        <header class="post-header">
          <h1 class="post-title">åˆ†å¸ƒå¼ç³»ç»Ÿä½œä¸šä¸¨02</h1>
          
          <div class="row post-desc">
            <div class="col-xs-6">
              
              <time class="post-date" datetime="2024-12-16 00:00:00 UTC">
                16 Dec 2024
              </time>
              
            </div>
            <div class="col-xs-6">
              
            </div>
          </div>
          
        </header>

        <div class="post-content markdown-body">
          
          <p><a style="color: #0000FF;" href="https:github.com/Zhang-Xiaoda/NJU-DisSys-2017/" target="_blank"> ä½œä¸šåœ°å€</a></p>
<h2 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h2>
<ul>
<li>è™šæ‹Ÿæœº Ubuntu-22.04.1</li>
<li>Go 1.23.4</li>
</ul>
<p><a style="color: #0000FF;" href="https://go.dev/dl/" target="_blank"> GO ä¸‹è½½åœ°å€</a></p>
<p>ç¬¬ä¸€æ¬¡æ¥è§¦ Go è¯­è¨€è¿˜æ˜¯è¸©äº†ä¸€äº›å‘çš„ï¼Œå› ä¸ºçœ‹åˆ°è€å¸ˆç»™å‡ºçš„ ppt è¦æ±‚åœ¨1.5ä»¥ä¸Šï¼Œå°±ä¸‹è½½äº†æœ€æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºå¢™çš„åŸå› ï¼Œæˆ‘çš„ Ubuntu ä¸èƒ½ç›´æ¥ä¸‹è½½ï¼Œæ‰€ä»¥ç”¨WinSCP ä¼ åˆ°æˆ‘çš„ Ubuntu é‡Œé¢å»ï¼Œæ¥ç€åœ¨bç«™æœç´¢äº†ä¸€ä¸ªéƒ¨ç½²ç¯å¢ƒçš„<a style="color: #0000FF;" href="https://www.bilibili.com/video/BV1PR4y1C7Bw/?spm_id_from=333.337.search-card.all.click&vd_source=1837baf7c46a027b7e27b4ab7174fb85" target="_blank">æ•™ç¨‹</a>ã€‚<del>ï¼ˆè™½ç„¶ä¸€å¼€å§‹é”™å®‰è£…æˆ32ä½çš„äº†ï¼Œå¯¼è‡´åç»­å®‰è£…å…¶ä»– package çš„æ—¶å€™ä¼šå’Œ gcc çš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼‰</del>ç„¶åæˆ‘å‘ç°æˆ‘ç…§ç€ PPT ä¸Šçš„æŒ‡ä»¤å»åšï¼Œå§‹ç»ˆä¸è¡Œã€‚æˆ‘çœ‹ç€æŠ¥é”™çš„å†…å®¹çªç„¶æƒ³èµ·äº†ä¹‹å‰çœ‹åˆ°åŒå­¦åœ¨ç¾¤é‡Œé—²èŠåˆ°è¿™ä¸ªä½œä¸šçš„æ—¶å€™çš„å†…å®¹ï¼Œå’Œ GO çš„ä¸åŒç‰ˆæœ¬çš„ç¯å¢ƒé…ç½®æœ‰å…³ï¼Œå½“æ—¶è§‰å¾—å¯èƒ½æœ‰ç”¨å°±é¡ºæ‰‹æ”¶è—äº†ï¼Œäºæ˜¯æˆ‘ç¿»å‡ºæ”¶è—çš„å†…å®¹ï¼Œè¾“å…¥æŒ‡ä»¤ <code>export GO111MODULE=off</code> æœç„¶å¥½ä½¿ã€‚</p>
<h2 id="assignment-part-i">Assignment Part I</h2>
<h4 id="ä»»åŠ¡è¦æ±‚">ä»»åŠ¡è¦æ±‚</h4>
<ul>
<li>
<p>Implement Raft by adding code to raft/raft.go (only)</p>
<p>â€“ find some example code of how to send and receive RPC</p>
</li>
<li>
<p>Your task: Leader election:</p>
<p>â€“ First task is to fill the RequestVoteArgs and RequestVoteReply structs</p>
<p>â€“ Modify Make() to create a background goroutine that starts an election by sending out RequestVote RPC when it hasnâ€™t heard from another peer for a while</p>
<ul>
<li>You need to implement RequestVote RPC handler so that servers will vote for one another</li>
</ul>
<p>â€“ To implement heartbeats, you will need to define AppendEntries struct (though you will not need any real payload yet), and have the leader send them out periodically</p>
<ul>
<li>
<p>Also need to implement AppendEntries RPC handler</p>
<p>â€“ make sure the election timeouts don&rsquo;t always fire at the same time</p>
</li>
</ul>
</li>
</ul>
<h4 id="ä»»åŠ¡ç†è§£">ä»»åŠ¡ç†è§£</h4>
<p>ä»…ä»…éœ€è¦æ›´æ”¹ä¸€ä¸ªæ–‡ä»¶ raft.go ï¼Œçœ‹èµ·æ¥ä¸é”™ï¼Œæˆ‘è¿˜éœ€è¦åœ¨è¿™ä¸ªæ–‡ä»¶å†…æ‰¾åˆ°æœ‰å…³ rpc çš„ç¤ºä¾‹ä»£ç ï¼›</p>
<p>æ‰¾åˆ°ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"style="position:relative;"><pre><code class="language-java" data-lang="java" id = "code1">func (rf *Raft) sendRequestVote(server int, args RequestVoteArgs, reply *RequestVoteReply) bool {
	ok := rf.peers[server].Call("Raft.RequestVote", args, reply)
	return ok
}</code></pre>
<button class="copy-button" data-clipboard-target="#code1">Copy</button>
</div>
<p>è¿˜é™„åŠ äº†ä¸€æ®µæç¤ºä¿¡æ¯ï¼šä»¥ä¸Šæ˜¯ä¸€æ®µç”¨äºå‘æœåŠ¡å™¨å‘é€â€œè¯·æ±‚æŠ•ç¥¨â€ï¼ˆRequestVoteï¼‰è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰çš„ç¤ºä¾‹ä»£ç ã€‚ â€œserverâ€æ˜¯ç›®æ ‡æœåŠ¡å™¨åœ¨â€œrf.peers[]â€ä¸­çš„ç´¢å¼•ã€‚ é¢„æœŸåœ¨â€œargsâ€ä¸­å­˜æ”¾ç€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„å‚æ•°ï¼Œå¹¶ä¸”ä¼šç”¨è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„å›å¤æ¥å¡«å……â€œ*replyâ€ï¼Œæ‰€ä»¥è°ƒç”¨è€…åº”å½“ä¼ å…¥â€œ&amp;replyâ€ã€‚ ä¼ é€’ç»™â€œCall()â€å‡½æ•°çš„å‚æ•°å’Œå›å¤çš„ç±»å‹å¿…é¡»ä¸åœ¨å¤„ç†å‡½æ•°ä¸­å£°æ˜çš„å‚æ•°ç±»å‹ä¸€è‡´ï¼ˆåŒ…æ‹¬å®ƒä»¬æ˜¯å¦ä¸ºæŒ‡é’ˆç±»å‹ï¼‰ã€‚ å¦‚æœå®éªŒå®¤è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¡†æ¶ï¼ˆlabrpcï¼‰è¡¨æ˜è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å·²æˆåŠŸé€è¾¾ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°è¿”å›â€œtrueâ€ã€‚ å¦‚æœä½ åœ¨ä½¿è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ­£å¸¸å·¥ä½œæ–¹é¢é‡åˆ°å›°éš¾ï¼Œè¯·æ£€æŸ¥ä½ æ˜¯å¦å·²å°†é€šè¿‡è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ä¼ é€’çš„ç»“æ„ä½“ä¸­çš„æ‰€æœ‰å­—æ®µåç§°å¤§å†™ï¼Œå¹¶ä¸”è°ƒç”¨è€…ä¼ å…¥çš„æ˜¯å›å¤ç»“æ„ä½“çš„åœ°å€ï¼ˆä½¿ç”¨â€œ&amp;â€ï¼‰ï¼Œè€Œä¸æ˜¯å›å¤ç»“æ„ä½“æœ¬èº«ã€‚</p>
<p>æˆ‘è¦åšçš„äº‹æ˜¯å¡«å†™ RequestVoteArgs å’Œ RequestVoteReply ç»“æ„ä½“ï¼›ä¿®æ”¹ Make() ä»¥åˆ›å»ºä¸€ä¸ªåå°åç¨‹ï¼Œå½“å®ƒæœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°å¦ä¸€ä¸ª peer çš„æ¶ˆæ¯æ—¶ï¼Œå®ƒé€šè¿‡å‘é€ RequestVote RPC æ¥å¯åŠ¨é€‰ä¸¾ï¼ŒRequestVote RPC å¤„ç†ç¨‹åºä¹Ÿæ˜¯è‡ªå·±å®ç°ï¼Œä»¥ä¾¿æœåŠ¡å™¨ç›¸äº’æŠ•ç¥¨ï¼›è¦å®ç°å¿ƒè·³çš„æœºåˆ¶ï¼Œæˆ‘è¿˜éœ€è¦éœ€è¦å®šä¹‰ AppendEntries ç»“æ„ï¼ˆå°½ç®¡æˆ‘ç°åœ¨è¿˜ä¸éœ€è¦ä»»ä½•å®é™…çš„æœ‰æ•ˆè´Ÿè½½ï¼Œè¿™é‡Œçš„æœ‰æ•ˆè´Ÿè½½åº”è¯¥æ˜¯è¯´æºå¸¦çš„ä¿¡æ¯ï¼Œå› ä¸ºæˆ‘è®°å¾—ä¿¡æ¯çš„ä¼ é€’ä¹Ÿæ˜¯éšç€å¿ƒè·³è¿›è¡Œçš„ï¼‰ï¼Œå¹¶è®©é¢†å¯¼è€…å®šæœŸå‘é€å®ƒä»¬ï¼Œè¿˜éœ€è¦å®ç° AppendEntries RPC å¤„ç†ç¨‹åºï¼›ä»¥åŠç¡®ä¿ Election Timeouts ä¸ä¼šæ€»æ˜¯åŒæ—¶è§¦å‘ã€‚<strong>æç¤º</strong>ï¼šé€šè¿‡ RPC å‘é€çš„ä»»ä½•ç»“æ„çš„å­—æ®µåç§°å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚</p>
<p>æ€»çš„æ¥è¯´å°±æ˜¯å…ˆå®ç° raft å’Œé€‰ä¸¾æœ‰å…³çš„éƒ¨åˆ†ï¼Œè·ç¦»ä¸Šæ¬¡å­¦ä¹ çš„æ—¶å€™å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œç°åœ¨æ­£å¥½å…ˆå¤ä¹ ä¸€ä¸‹ï¼š</p>
<h4 id="raft-å›¾è§£æ¥æºäºa-stylecolor-0000ff-hrefhttpsthesecretlivesofdatacomraft-target_blankillustrated-raft-guidea">Raft å›¾è§£ï¼ˆæ¥æºäº<a style="color: #0000FF;" href="https://thesecretlivesofdata.com/raft/" target="_blank">illustrated Raft guide</a></h4>
<p>ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥çœ‹åšå­˜å‚¨å•ä¸ªå€¼çš„æ•°æ®åº“æœåŠ¡å™¨ï¼Œå½“åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯å¯ä»¥å¾ˆè½»æ¾åœ°å’Œä¸€ä¸ªèŠ‚ç‚¹è¾¾æˆä¸€è‡´ã€‚ä½†æ˜¯å½“æœ‰å¤šä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚ä½•è¾¾æˆä¸€è‡´ï¼Ÿåœ¨è¿™é‡Œï¼ŒRaft æ˜¯ä¸€ç§ç”¨äºå®ç°åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„åè®®ï¼Œè®©æˆ‘ä»¬æ¥å¤§è‡´çœ‹ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p>
<p>ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å¤„äºä¸‰ç§çŠ¶æ€ä¹‹ä¸€åˆ†åˆ«æ˜¯Follower Stateã€Candidate stateã€Leader stateã€‚æ‰€æœ‰èŠ‚ç‚¹éƒ½ä» Follower çŠ¶æ€å¼€å§‹ï¼Œå¦‚æœ follower èŠ‚ç‚¹æ²¡æœ‰ä»ä¸€ä¸ª leader å¤„æ¥æ”¶åˆ°ä¿¡æ¯ï¼Œé‚£ä¹ˆä»–ä»¬å¯ä»¥å˜ä¸º candidateï¼Œç„¶åï¼Œcandidate å‘å…¶ä»–èŠ‚ç‚¹è¯·æ±‚æŠ•ç¥¨ï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šå›å¤ä»–ä»¬çš„æŠ•ç¥¨ï¼Œå½“ä¸€ä¸ª candidate ä»å¤§å¤šæ•°èŠ‚ç‚¹è·å–æŠ•ç¥¨ä¹‹åå®ƒå°±ä¼šæˆä¸º leaderï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åš leader ç«é€‰ã€‚</p>
<p>ç°åœ¨ï¼Œå¯¹ç³»ç»Ÿçš„æ‰€æœ‰æ›´æ”¹éƒ½è¦ç»è¿‡leader èŠ‚ç‚¹ã€‚æ¯é¡¹æ›´æ”¹éƒ½ä¼šä½œä¸ºä¸€æ¡è®°å½•æ·»åŠ åˆ°èŠ‚ç‚¹çš„æ—¥å¿—ä¸­ï¼Œè¿™æ¡æ—¥å¿—è®°å½•ç›®å‰å°šæœªæäº¤ï¼Œæ‰€ä»¥å®ƒä¸ä¼šæ›´æ–°èŠ‚ç‚¹çš„å€¼ï¼Œè¦æäº¤è¯¥è®°å½•ï¼ŒèŠ‚ç‚¹é¦–å…ˆä¼šå°†å®ƒå¤åˆ¶åˆ° follower èŠ‚ç‚¹ï¼Œç„¶åï¼Œleader ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å¤§å¤šæ•°èŠ‚ç‚¹éƒ½å·²å†™å…¥è¯¥è®°å½•å¹¶å›å¤ã€‚è¯¥è®°å½•ç°åœ¨å·²åœ¨ leader èŠ‚ç‚¹ä¸Šæäº¤ï¼Œä¸”èŠ‚ç‚¹çŠ¶æ€ä¸º â€œ5â€ã€‚ç„¶åï¼Œleader ä¼šé€šçŸ¥ follower è¯¥è®°å½•å·²è¢«æäº¤ï¼Œé›†ç¾¤ç°åœ¨å·²ç»å°±ç³»ç»ŸçŠ¶æ€è¾¾æˆäº†å…±è¯†ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º Log Replication ã€‚</p>
<p>åœ¨ Raft ä¸­ï¼Œæœ‰ä¸¤ä¸ªç”¨äºæ§åˆ¶é€‰ä¸¾çš„è¶…æ—¶è®¾ç½®ã€‚ç¬¬ä¸€ä¸ªæ˜¯é€‰ä¸¾è¶…æ—¶ï¼ˆelection timeoutï¼‰ï¼Œelection timeout æ˜¯æŒ‡ä¸€ä¸ª follower åœ¨è½¬å˜ä¸º candidate ä¹‹å‰ç­‰å¾…çš„æ—¶é•¿ï¼Œé€‰ä¸¾è¶…æ—¶æ—¶é—´è¢«éšæœºè®¾å®šåœ¨ 150 æ¯«ç§’åˆ° 300 æ¯«ç§’ä¹‹é—´ã€‚åœ¨é€‰ä¸¾è¶…æ—¶ä¹‹åï¼Œfollower ä¼šå˜æˆ candidate ï¼Œå¹¶å¼€å¯ä¸€ä¸ªæ–°çš„election termï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼Œå¹¶å‘å…¶ä»–èŠ‚ç‚¹å‘é€ â€œè¯·æ±‚æŠ•ç¥¨â€ æ¶ˆæ¯ã€‚å¦‚æœæ¥æ”¶çš„èŠ‚ç‚¹åœ¨è¿™ä¸ª term å†…å°šæœªæŠ•ç¥¨ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šç»™è¯¥å€™é€‰è€…æŠ•ç¥¨ï¼Œå¹¶ä¸”è¯¥èŠ‚ç‚¹ä¼šé‡ç½®å…¶ election timeout æ—¶é—´ã€‚ä¸€æ—¦ä¸€ä¸ª candidate è·å¾—äº†å¤§éƒ¨åˆ†çš„æŠ•ç¥¨ï¼Œå®ƒå°±æˆä¸ºä¸€ä¸ª leaderã€‚leader å¼€å§‹å‘å…¶ follower å‘é€é™„åŠ æ¡ç›®ï¼ˆAppend Entriesï¼‰æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯æŒ‰ç…§å¿ƒè·³è¶…æ—¶ï¼ˆheartbeat timeoutï¼‰æ‰€è§„å®šçš„æ—¶é—´é—´éš”è¿›è¡Œå‘é€ï¼Œéšåï¼Œfollower ä¼šå¯¹æ¯æ¡ Append Entries æ¶ˆæ¯åšå‡ºå›åº”è¡¨ç¤ºæ¥æ”¶åˆ°ï¼Œè¿™ä¸ª election term å°†æŒç»­ä¸‹å»ï¼Œç›´åˆ°æŸä¸ª follower åœæ­¢æ¥æ”¶åˆ° heartbeat å¹¶è½¬å˜ä¸º candidate ä¸ºæ­¢ã€‚è¦æ±‚è·å¾—å¤šæ•°æŠ•ç¥¨å¯ç¡®ä¿æ¯ä¸ª term åªèƒ½é€‰å‡ºä¸€ä½ leader ï¼Œå¦‚æœä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶æˆä¸º candidate ï¼Œé‚£ä¹ˆå°±å¯èƒ½å‡ºç°é€‰ç¥¨åˆ†æ•£ï¼ˆå¹³ç¥¨ï¼‰çš„æƒ…å†µã€‚ä»ä¾‹å­æ¥çœ‹å¹³ç¥¨çš„æƒ…å†µï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„æŠ•ç¥¨åªèƒ½è¢«æ¥æ”¶ä¸€æ¬¡ï¼Œäºæ˜¯è¿™äº›èŠ‚ç‚¹å°†ä¼šç­‰å¾…æ–°ä¸€è½®é€‰ä¸¾ï¼Œç„¶åå†æ¬¡å°è¯•ã€‚</p>
<p>ä¸€æ—¦æˆ‘ä»¬é€‰å‡ºäº† leader ï¼Œå°±éœ€è¦å°†ç³»ç»Ÿä¸­çš„æ‰€æœ‰å˜æ›´å¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œè¿™æ˜¯é€šè¿‡ä½¿ç”¨æ›¾ç”¨äº heartbeats çš„ç›¸åŒçš„ Append Entries æ¶ˆæ¯æ¥å®Œæˆçš„ã€‚é¦–å…ˆä¸€ä¸ªå®¢æˆ·ç«¯å‘é€ç»™ leader ä¸€ä¸ªå˜æ›´ï¼Œè¯¥å˜æ›´ä¼šè¢«é™„åŠ åˆ° leader çš„æ—¥å¿—ä¸­ï¼Œç„¶åï¼Œè¯¥å˜æ›´ä¼šåœ¨ä¸‹ä¸€æ¬¡ heartbeat æ—¶å‘é€ç»™ followerï¼Œä¸€æ—¦å¤§å¤šæ•° follower ç¡®è®¤äº†æŸä¸ª Entry ï¼Œè¯¥ Entry å°±ä¼šè¢«æäº¤ï¼Œå¹¶ä¸” leader ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå“åº”ã€‚å³ä½¿é¢å¯¹ç½‘ç»œåˆ†åŒºçš„æƒ…å†µï¼ŒRaft ä¹Ÿèƒ½ä¿æŒä¸€è‡´æ€§ï¼Œæ¯”å¦‚ A ã€B ä½œä¸ºä¸€ä¸ª partition ï¼ŒCã€Dã€E ä½œä¸ºä¸€ä¸ª partitionï¼Œç”±äºå‡ºç°äº†ç½‘ç»œåˆ†åŒºï¼Œæˆ‘ä»¬ç°åœ¨åœ¨ä¸åŒçš„ä»»æœŸå†…æœ‰äº†ä¸¤ä¸ªé¢†å¯¼è€…ï¼Œæˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¹¶å°è¯•å¯¹è¿™ä¸¤ä¸ª leader éƒ½è¿›è¡Œæ›´æ–°æ“ä½œã€‚ä¸€ä¸ªå®¢æˆ·ç«¯å°†å°è¯•æŠŠèŠ‚ç‚¹ B çš„å€¼è®¾ç½®ä¸º â€œ3â€ï¼ŒèŠ‚ç‚¹ B æ— æ³•å¤åˆ¶åˆ°å¤šæ•°èŠ‚ç‚¹ï¼Œæ‰€ä»¥å®ƒçš„æ—¥å¿—æ¡ç›®ä¿æŒæœªæäº¤çŠ¶æ€ï¼›å¦ä¸€ä¸ªå®¢æˆ·ç«¯å°†å°è¯•æŠŠèŠ‚ç‚¹ C çš„å€¼è®¾ç½®ä¸º â€œ8â€ï¼Œè¿™ä¸ªä¼šæˆåŠŸå› ä¸ºå®ƒå¯ä»¥å¤åˆ¶ç»™å¤šæ•°èŠ‚ç‚¹ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¿®å¤ç½‘ç»œçš„åˆ†åŒºã€‚èŠ‚ç‚¹ B å°†ä¼šå¯Ÿè§‰åˆ°æ›´é«˜çš„ termï¼Œç„¶åä¸»åŠ¨é€€ä½ï¼ˆä¸å†æ‹…ä»» leaderï¼‰ï¼ŒèŠ‚ç‚¹ A å’ŒèŠ‚ç‚¹ B éƒ½ä¼šå›æ»šå®ƒä»¬æœªæäº¤çš„æ¡ç›®ï¼Œå¹¶ä¸æ–° leader çš„æ—¥å¿—ä¿æŒä¸€è‡´ï¼Œç°åœ¨æˆ‘ä»¬é›†ç¾¤ä¸­çš„æ—¥å¿—æ˜¯ä¸€è‡´çš„äº†ã€‚</p>
<p><a style="color: #0000FF;" href="https://www.bilibili.com/video/BV1fD4y1m7TD/?spm_id_from=333.999.0.0" target="_blank"> GO è¯­è¨€å¿«é€Ÿå…¥é—¨</a> åœ¨è¿™é‡Œå­¦ä¹ ä¸€ä¸‹ GO è¯­è¨€</p>
<h4 id="è®¾è®¡å®ç°">è®¾è®¡å®ç°</h4>
<h5 id="ç»“æ„ä½“è®¾è®¡">ç»“æ„ä½“è®¾è®¡</h5>
<div class="highlight"style="position:relative;"><pre><code class="language-java" data-lang="java" id = "code2">type RequestVoteArgs struct {
	Term         int // candidateçš„å½“å‰ä»»æœŸ
	CandidatedId int // è¯·æ±‚æŠ•ç¥¨çš„candidateçš„ID
	LastLogIndex int // candidateæœ€åä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„indexï¼ˆç¡®ä¿å®‰å…¨æ€§çš„é€‰ä¸¾é™åˆ¶ç”¨ï¼‰
	LastLogTerm  int // candidateæœ€åä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„termï¼ˆç¡®ä¿å®‰å…¨æ€§çš„é€‰ä¸¾é™åˆ¶ç”¨ï¼‰
}
&nbsp;
type RequestVoteReply struct {
	Term        int
	VoteGranted bool
}
&nbsp;
type Raft struct {
	mu        sync.Mutex
	peers     []*labrpc.ClientEnd
	persister *Persister
	me        int // index into peers[]
	&nbsp;
	ballot  int           //é€‰ç¥¨æ•°é‡
	timer   *time.Timer   // è®¡æ—¶å™¨æŒ‡é’ˆï¼Œç”¨äºæ§åˆ¶é€‰ä¸¾è¶…æ—¶
	state   string        // å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€ Follower, Candidate æˆ–è€… Leader
	term    int           //å½“å‰é€‰ä¸¾çš„ term
	voteTo  int           //è¡¨ç¤º vote çš„å¯¹è±¡ï¼Œå¦‚æœæ˜¯-1è¡¨ç¤ºè¿˜æœªæŠ•ç¥¨ï¼Œå¦‚æœä¸æ˜¯-1ä¸èƒ½å†æŠ•ç¥¨
	timeout time.Duration //é€‰ä¸¾è¶…æ—¶æ—¶é—´
	log     []LogEntry    // æ­¤Serverçš„æ—¥å¿—ï¼ŒåŒ…å«äº†è‹¥å¹²æ—¥å¿—æ¡ç›®ï¼Œç±»å‹æ˜¯æ—¥å¿—æ¡ç›®çš„åˆ‡ç‰‡ï¼Œç¬¬ä¸€ä¸ªæ—¥å¿—ç´¢å¼•æ˜¯1
	applyCh chan ApplyMsg //  æ ¹æ®Make()åŠå…¶ä»–éƒ¨åˆ†çš„æ³¨é‡Šï¼Œraft serveréœ€è¦ç»´æŠ¤ä¸€ä¸ªå‘é€ApplyMsgçš„ç®¡é“
	&nbsp;
	// æ‰€æœ‰server å®¹æ˜“æ”¹å˜çš„çŠ¶æ€
	commitIndex int
	lastApplied int
	&nbsp;
	// Leader å®¹æ˜“æ”¹å˜çš„çŠ¶æ€
	nextIndex  []int
	matchIndex []int
}
&nbsp;
type LogEntry struct {
	Command interface{} // å®¢æˆ·ç«¯è¦æ±‚çš„æŒ‡ä»¤
	Term    int         // æ­¤æ—¥å¿—æ¡ç›®çš„term
}</code></pre>
<button class="copy-button" data-clipboard-target="#code2">Copy</button>
</div>
<p>ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ˜¯æŠ•ç¥¨ä¿¡æ¯ RPC ä¼ è¾“å‚æ•°çš„ç»“æ„ä½“ï¼›æŠ•ç¥¨ä¿¡æ¯ RPC å›å¤çš„ç»“æ„ä½“ï¼›å­˜å‚¨ä¸€ä¸ª serverï¼ˆ ç½‘ç»œä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ä¿¡æ¯çš„ç»“æ„ä½“ï¼›æ—¥å¿—æ¡ç›®çš„ç»“æ„ä½“ï¼Œç”¨æ¥å­˜å‚¨æ—¥å¿—ä¿¡æ¯ã€‚å…·ä½“ä¿¡æ¯è§æ³¨é‡Šã€‚</p>
<h5 id="å…³é”®å‡½æ•°">å…³é”®å‡½æ•°</h5>
<div class="highlight"style="position:relative;"><pre><code class="language-java" data-lang="java" id = "code3">func (rf *Raft) tick() {
	if rf.timer != nil {
		// å¦‚æœ timer å·²ç»åˆå§‹åŒ–ï¼Œåœä¸‹ä¹‹å‰çš„ timer
		rf.timer.Stop()
	}
	rf.timer = time.AfterFunc(rf.timeout, func() { rf.ElectionTimeout() }) // æ›´æ–° timer
}
&nbsp;
func (rf *Raft) RequestVote(args RequestVoteArgs, reply *RequestVoteReply) {
	// Your code here.
	rf.mu.Lock()
	defer rf.mu.Unlock()
	&nbsp;
	// å¡«å……å›å¤å‚æ•°çš„é»˜è®¤å€¼
	reply.Term = rf.term // å¦‚æœè¯·æ±‚è€…çš„ term æ¯”å½“å‰èŠ‚ç‚¹æ—§ï¼Œå€™é€‰è€…å°†æ›´æ–° term
	reply.VoteGranted = false
	&nbsp;
	//å¦‚æœè¯·æ±‚è€…çš„ä»»æœŸ term æ¯”å½“å‰èŠ‚ç‚¹æ—§ï¼Œåˆ™ç›´æ¥æ‹’ç»æŠ•ç¥¨
	if args.Term < rf.term {
		return
	}
	&nbsp;
	// å¦‚æœè¯·æ±‚è€…çš„ä»»æœŸæ¯”å½“å‰èŠ‚ç‚¹æ–°ï¼Œåˆ™æ›´æ–°ä¸ºè·Ÿéšè€…ï¼ˆFollowerï¼‰
	if args.Term > rf.term {
		rf.state = "Follower"
		rf.voteTo = args.CandidatedId
		rf.persist()
	}
	&nbsp;
	// æ›´æ–°å½“å‰èŠ‚ç‚¹çš„ä»»æœŸä¸ºè¯·æ±‚è€…çš„ä»»æœŸ
	rf.term = args.Term
	if (rf.voteTo == -1 || rf.voteTo == args.CandidatedId) && rf.incomingFresher(args) {
		rf.state = "Follower"
		reply.VoteGranted = true
		rf.voteTo = args.CandidatedId
		rf.persist()
		rf.tick()
	}
}
&nbsp;
func (rf *Raft) RequestVote(args RequestVoteArgs, reply *RequestVoteReply) {
	// Your code here.
	rf.mu.Lock()
	defer rf.mu.Unlock()
	&nbsp;
	// æ„é€ å‚æ•°ä¿¡æ¯
	reply.Term = rf.term // if fresher, candidate will update
	reply.VoteGranted = false
	if args.Term < rf.term { // all ready seen leader for this term
		return
	}
	&nbsp;
	if args.Term > rf.term { // agree if your term is more recent
		rf.state = "Follower"
		rf.voteTo = args.CandidatedId
		rf.persist()
	}
	&nbsp;
	rf.term = args.Term // update own term
	if (rf.voteTo == -1 || rf.voteTo == args.CandidatedId) && rf.incomingFresher(args) {
		rf.state = "Follower"
		reply.VoteGranted = true
		rf.voteTo = args.CandidatedId
		rf.persist()
		rf.tick()
	}
}
&nbsp;
func (rf *Raft) incomingFresher(args RequestVoteArgs) bool {
	if len(rf.log) == 0 {
		return true
	}
	if args.LastLogTerm == rf.log[len(rf.log)-1].Term {
		return len(rf.log)-1 <= args.LastLogIndex
	}
	return args.LastLogTerm > rf.log[len(rf.log)-1].Term
}
&nbsp;
func (rf *Raft) handleVoteResult(reply RequestVoteReply) {
	rf.mu.Lock()
	defer rf.mu.Unlock()
	&nbsp;
	if reply.Term > rf.term {
		rf.term = reply.Term
		rf.state = "Follower"
		rf.voteTo = -1
		rf.persist()
		rf.tick()
		return
	}
	&nbsp;
	if reply.VoteGranted && rf.state == "Candidate" {
		rf.ballot++
		if rf.ballot > len(rf.peers)/2 { // majority
			rf.state = "Leader" // step up
			rf.persist()
			for i := 0; i < len(rf.peers); i++ {
				if i == rf.me {
					continue
				}
				rf.nextIndex[i] = len(rf.log)
				rf.matchIndex[i] = -1 // index ä»0å¼€å§‹, æ‰€ä»¥åˆå§‹åŒ–ä¸º-1
			}
			rf.tick()
			go func() {
				rf.stepUpCallback() // å‘é€ heartbeat
			}()
		}
	}
}
&nbsp;
func (rf *Raft) ElectionTimeout() {
	rf.mu.Lock()
	defer rf.mu.Unlock()
	if rf.state == "Leader" {
		// Leader ä»…ä»…åˆ·æ–° timer
		rf.tick()
	} else {
		rf.state = "Candidate"
		rf.voteTo = rf.me
		rf.persist()
		rf.ballot = 1
		rf.term += 1
		&nbsp;
		// æ„é€ å‚æ•°ä¿¡æ¯
		var args RequestVoteArgs
		args.Term = rf.term
		args.CandidatedId = rf.me
		args.LastLogIndex = len(rf.log) - 1
		if len(rf.log) == 0 {
			args.LastLogTerm = -1
		} else {
			args.LastLogTerm = rf.log[len(rf.log)-1].Term
		}
		&nbsp;
		// å‘é€ RequestForVote å¹¶æ¥å—å›å¤
		f := func(server int, args RequestVoteArgs) {
			var resp RequestVoteReply
			var ifSuccess = rf.sendRequestVote(server, args, &resp)
			if ifSuccess {
				rf.handleVoteResult(resp)
			}
		}
		for i := 0; i < len(rf.peers); i++ {
			if i != rf.me {
				go f(i, args)
			}
		}
		rf.tick()
	}
}
&nbsp;
func Make(peers []*labrpc.ClientEnd, me int,
	persister *Persister, applyCh chan ApplyMsg) *Raft {
	rf := &Raft{}
	rf.peers = peers
	rf.persister = persister
	rf.me = me
	&nbsp;
	// Your initialization code here.
	rf.term = 0
	rf.state = "Follower" // serveråˆšå¼€å§‹ä¸ºfollowerï¼Œä¸”current termä¸º0
	rf.voteTo = -1        // åˆå§‹æ—¶è¿˜æ²¡æŠ•ç¥¨ï¼Œå°±ä¸º-1
	rf.readPersist(persister.ReadRaftState())
	rf.log = make([]LogEntry, 0)
	timeout := rand.Intn(150) + 150
	rf.timeout = time.Duration(timeout) * time.Millisecond
	rf.ballot = 0
	&nbsp;
	rf.commitIndex = -1
	rf.lastApplied = -1
	&nbsp;
	rf.nextIndex = make([]int, len(rf.peers))
	rf.matchIndex = make([]int, len(rf.peers))
	&nbsp;
	rf.applyCh = applyCh
	&nbsp;
	rf.tick()
	rf.readPersist(persister.ReadRaftState())
	return rf
}</code></pre>
<button class="copy-button" data-clipboard-target="#code3">Copy</button>
</div>
<strong>tick</strong> å‡½æ•°ç”¨æ¥æ›´æ–° timer ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¼šæ›´æ–°è‡ªå·±çš„ timer çš„æƒ…å†µæœ‰â‘ æ”¶åˆ° RequestVote â‘¡èŠ‚ç‚¹åˆå§‹åŒ–â‘¢ç«é€‰æ—¶ç­‰å¾…æŠ•ç¥¨â‘£æ”¶åˆ°çš„æŠ•ç¥¨æˆ– AppendEntries çš„ term å¤§äºè‡ªå·±æ—¶â‘¤ç«é€‰å¤±è´¥ï¼›<strong>RequestVote</strong> å‡½æ•°ç”¨æ¥å¤„ç†æ”¶åˆ°çš„ RPC ä¼ é€’çš„æŠ•ç¥¨ä¿¡æ¯ï¼›<strong>incomingFresher</strong> å‡½æ•°ç”¨äºåˆ¤æ–­æ˜¯å¦åº”è¯¥å°†æŠ•ç¥¨æƒæˆäºˆå€™é€‰è€…ï¼Œä¿è¯æŠ•ç¥¨æ—¶é€‰æ‹©æ—¥å¿—çŠ¶æ€æ›´æ–°çš„å€™é€‰è€…ï¼Œç¡®ä¿æ—¥å¿—çš„ä¸€è‡´æ€§å’Œæœ€æ–°æ€§ï¼›<strong>handleVoteResult</strong> å‡½æ•°ç”¨äºå€™é€‰äººæ”¶åˆ°é€‰ç¥¨å›å¤çš„å¤„ç†ï¼›<strong>ElectionTimeout</strong> å‡½æ•°ç”¨äºå¤„ç†é€‰ä¸¾çš„æµç¨‹ï¼Œå¯¹äº Leader ä»€ä¹ˆéƒ½ä¸ä¼šåšï¼›<strong>stepUpCallback</strong> å‡½æ•°ç”¨äºèŠ‚ç‚¹å½“é€‰ Leader ä¹‹åçš„ heartbeat çš„å¤„ç†ï¼›<strong>Make </strong>å‡½æ•°ç”¨æ¥ç»™ server åˆå§‹åŒ–ã€‚
<h4 id="é€šè¿‡æµ‹è¯•">é€šè¿‡æµ‹è¯•</h4>
<img src = "test1.png" alt = "æµ‹è¯•1" />
<h2 id="assignment-part-ii">Assignment Part II</h2>
<h4 id="ä»»åŠ¡è¦æ±‚-1">ä»»åŠ¡è¦æ±‚</h4>
<p>â€“ Implement the leader and follower code to append new log entries</p>
<ul>
<li>implementing Start(), completing the AppendEntries RPC structs, sending them, and completing the AppendEntry RPC handler</li>
<li>pass the TestBasicAgree() test, try to pass all test beforeâ€œPersistâ€</li>
</ul>
<h4 id="ä»»åŠ¡ç†è§£-1">ä»»åŠ¡ç†è§£</h4>
<p>å®ç° leader å’Œ follower çš„ä»£ç ä»¥æ·»åŠ æ–°çš„æ—¥å¿—æ¡ç›®ï¼Œå®ç° Start()ï¼Œå®Œæˆ AppendEntries RPC ç»“æ„ï¼Œå‘é€å®ƒä»¬ï¼Œå¹¶å®Œæˆ AppendEntry RPC å¤„ç†ç¨‹åºã€‚</p>
<h4 id="è®¾è®¡å®ç°-1">è®¾è®¡å®ç°</h4>
<h5 id="ç»“æ„ä½“è®¾è®¡-1">ç»“æ„ä½“è®¾è®¡</h5>
<div class="highlight"style="position:relative;"><pre><code class="language-java" data-lang="java" id = "code4">type AppendEntriesArgs struct {
	Term        int // leaderçš„ä»»æœŸ
	Leader      int
	PreLogIndex int        // æ–°æ¡ç›®ä¹‹å‰çš„ç´§æ¥ç€çš„æ—¥å¿—çš„ç´¢å¼•
	PreLogTerm  int        // æ–°æ¡ç›®ä¹‹å‰çš„ç´§æ¥ç€çš„æ—¥å¿—çš„ä»»æœŸ
	Entries     []LogEntry // è¦å­˜å‚¨/è¿½åŠ åˆ°serverçš„æ—¥å¿—æ¡ç›®ï¼Œä¸ºäº†æ•ˆç‡å¯ä¸€æ¬¡è¿½åŠ å¤šæ¡ï¼ˆè‹¥ä¸º heartbeat åˆ™æ­¤å­—æ®µä¸ºç©ºï¼‰
	CommitTo    int        // leaderæäº¤åˆ°çš„æ—¥å¿—ç´¢å¼•ä½ç½®
}
&nbsp;
type AppendEntriesReply struct {
	Term    int  // RPCæ¥æ”¶serverçš„current termï¼Œleaderæ›´æ–°è‡ªå·±ç”¨ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰
	Success bool // å¦‚æœfolloweråŒ…å«æœ‰åŒ¹é…leaderçš„preLogIndexä»¥åŠpreLogTermçš„æ—¥å¿—æ¡ç›®åˆ™è¿”å›true
}</code></pre>
<button class="copy-button" data-clipboard-target="#code4">Copy</button>
</div>
<p>AppendEntriesArgs æ˜¯è¿½åŠ æ—¥å¿—æ¡ç›® RPC ä¼ è¾“å‚æ•°çš„ç»“æ„ä½“ï¼›AppendEntriesReply æ˜¯è¿½åŠ æ—¥å¿—æ¡ç›®çš„ RPC å›å¤ç»“æ„ä½“ã€‚</p>
<h5 id="å…³é”®å‡½æ•°-1">å…³é”®å‡½æ•°</h5>
<div class="highlight"style="position:relative;"><pre><code class="language-java" data-lang="java" id = "code5">func (rf *Raft) AppendEntries(args *AppendEntriesArgs, reply *AppendEntriesReply) {
	rf.mu.Lock()
	defer rf.mu.Unlock()
	&nbsp;
	reply.Term = rf.term
	if rf.term > args.Term {
		reply.Success = false
		return
	} else {
		rf.term = args.Term
		rf.state = "Follower" // in case disconnected leader wake up
		rf.voteTo = -1
		rf.persist()
		reply.Term = rf.term
		rf.tick()
		&nbsp;
		if args.PreLogIndex > -1 {
			if len(rf.log) <= args.PreLogIndex || 
				rf.log[args.PreLogIndex].Term != args.PreLogTerm {
				// ä¸åŒ¹é…
				reply.Success = false
				return
			}
		}
		&nbsp;
		// prevLogIndex å€¼ä¸º-1æˆ–è€…æˆåŠŸåŒ¹é…
		rf.log = rf.log[:args.PreLogIndex+1] // discard all following
		rf.log = append(rf.log, args.Entries...)
		rf.persist()
		if rf.commitIndex < args.CommitTo {
			rf.commitIndex = args.CommitTo
			go rf.refreshCommits()
		}
		reply.Success = true
	}
}
&nbsp;
func (rf *Raft) handleAppendEntriesResult(reply AppendEntriesReply, nodeId int) {
	rf.mu.Lock()
	defer rf.mu.Unlock()
	&nbsp;
	if rf.state != "Leader" {
		return
	}
	&nbsp;
	if reply.Term > rf.term {
		// è‡ªå·±çš„ term å·²ç»è¿‡æ—¶
		rf.term = reply.Term
		rf.state = "Follower"
		rf.voteTo = -1
		rf.persist()
	}
	&nbsp;
	if reply.Success {
		rf.matchIndex[nodeId] = rf.nextIndex[nodeId] - 1
		rf.nextIndex[nodeId] = len(rf.log) // æ›´æ–°, ç”¨äºåœ¨ä¸‹æ¬¡æ£€æŸ¥æ˜¯å¦æ˜¯æœ€æ–°çš„
		&nbsp;
		for i := len(rf.log) - 1; i >= 0 && i > rf.commitIndex; i-- {
			// term ä»é¢†å¯¼è€…å°šæœªæäº¤çš„æœ€åä¸€ä¸ªä»»æœŸå¼€å§‹å€’æ¨ã€‚
			if rf.log[i].Term != rf.term {
				break
			}
			&nbsp;
			count := 1
			for server := 0; server < len(rf.peers); server++ {
				if server == rf.me {
					continue
				}
				if rf.matchIndex[server] >= i {
					count++
				}
			}
			if count > len(rf.peers)/2 {
				rf.commitIndex = i // æ›´æ–° commitIndex
				rf.refreshCommits()
			}
		}
	} else {
		rf.nextIndex[nodeId]--
	}
}
&nbsp;
func (rf *Raft) sendAppendEntry2Index(nodeId int) {
	if nodeId == rf.me {
		return
	}
	var args AppendEntriesArgs // construct args
	args.Term = rf.term
	args.Leader = rf.me
	args.PreLogIndex = rf.nextIndex[nodeId] - 1
	if args.PreLogIndex >= 0 {
		args.PreLogTerm = rf.log[args.PreLogIndex].Term
	} else { // -1
		args.PreLogTerm = -1
	}
	args.Entries = rf.log[rf.nextIndex[nodeId]:]
	args.CommitTo = rf.commitIndex
	&nbsp;
	go func(server int, args AppendEntriesArgs) { // parallel sending
		var reply AppendEntriesReply
		ok := rf.sendAppendEntries(server, &args, &reply)
		if ok {
			rf.handleAppendEntriesResult(reply, server)
		}
	}(nodeId, args)
}
&nbsp;
func (rf *Raft) sendAppendEntries(server int, args *AppendEntriesArgs, reply *AppendEntriesReply) bool {
	ok := rf.peers[server].Call("Raft.AppendEntries", args, reply) // è°ƒç”¨å¯¹åº”serverçš„Raft.AppendEntriesæ–¹æ³•è¿›è¡Œè¯·æ±‚æ—¥å¿—è¿½åŠ å¤„ç†
	return ok
}
&nbsp;
func (rf *Raft) refreshCommits() {
	for logIndex := rf.lastApplied + 1; logIndex <= rf.commitIndex; logIndex++ {
		rf.applyCh <- ApplyMsg{Index: logIndex + 1, Command: rf.log[logIndex].Command}
	}
	rf.lastApplied = rf.commitIndex
}
</code></pre>
<button class="copy-button" data-clipboard-target="#code5">Copy</button>
</div>
AppendEntries å‡½æ•°æ˜¯å®é™…çš„æ—¥å¿—è¿½åŠ å¤„ç†å‡½æ•°ï¼›ç”± sendAppendEntries å‡½æ•°è°ƒç”¨ï¼›è€Œ sendAppendEntries åœ¨ sendAppendEntry2Index å‡½æ•°å‘é€è¿½åŠ æ¡ç›®ç»™ç‰¹å®šç´¢å¼•æ—¶è°ƒç”¨ï¼›handleAppendEntriesResult å‡½æ•°ç”¨äºå¤„ç† AppemdEntries çš„å›å¤ï¼›refreshCommits å‡½æ•°é€šè¿‡æ¯”è¾ƒè‡ªèº«çš„æœ€åå·²åº”ç”¨ç´¢å¼•ï¼ˆlastAppliedï¼‰å’Œæäº¤ç´¢å¼•ï¼ˆcommitIndexï¼‰æ¥åº”ç”¨æœªæäº¤çš„å‘½ä»¤ã€‚
<h4 id="é€šè¿‡æµ‹è¯•-1">é€šè¿‡æµ‹è¯•</h4>
<img src = "test2.png" alt = "æµ‹è¯•2" />
<h2 id="assignment-part-iii">Assignment Part III</h2>
<h4 id="ä»»åŠ¡è¦æ±‚-2">ä»»åŠ¡è¦æ±‚</h4>
<p>â€“ Handle the fault tolerant aspects of the Raft protocol</p>
<ul>
<li>require that Raft keep persistent state that survives a reboot (see Figure 2 for which states should be persistent)</li>
</ul>
<p>â€“ won&rsquo;t use the disk; instead, it will save and restore persistent state from a Persister (see persister.go)</p>
<ul>
<li>initialize its state from that Persister, and should use it to save its persistent state each time the state changes.</li>
</ul>
<p>â€“ You should determine at what points in the Raft protocol your servers are required to persist their state, and insert calls to persist() in those places</p>
<h4 id="ä»»åŠ¡ç†è§£-2">ä»»åŠ¡ç†è§£</h4>
<p>è¦æ±‚ Raft ä¿æŒæŒä¹…çŠ¶æ€ï¼Œè¯¥çŠ¶æ€åœ¨é‡å¯åä»ç„¶å­˜åœ¨ï¼ˆå‚è§å›¾ 2 äº†è§£å“ªäº›çŠ¶æ€åº”è¯¥æ˜¯æŒä¹…çŠ¶æ€ï¼‰ï¼Œä¸ä¼šä½¿ç”¨ç£ç›˜;ç›¸åï¼Œå®ƒå°†ä» Persister ä¿å­˜å’Œæ¢å¤æŒä¹…çŠ¶æ€ï¼ˆå‚è§ persister.goï¼‰ï¼Œä»è¯¥ Persister åˆå§‹åŒ–å…¶ stateï¼Œå¹¶åœ¨æ¯æ¬¡ state æ›´æ”¹æ—¶ä½¿ç”¨å®ƒæ¥ä¿å­˜å…¶æŒä¹… stateã€‚æ‚¨åº”è¯¥ç¡®å®šåœ¨ Raft åè®®ä¸­çš„å“ªäº›ç‚¹éœ€è¦æœåŠ¡å™¨ä¿ç•™å…¶çŠ¶æ€ï¼Œå¹¶åœ¨è¿™äº›ä½ç½®æ’å…¥å¯¹ persistï¼ˆï¼‰ çš„è°ƒç”¨ã€‚</p>
<h4 id="è®¾è®¡å®ç°-2">è®¾è®¡å®ç°</h4>
<div class="highlight"style="position:relative;"><pre><code class="language-java" data-lang="java" id = "code6">func (rf *Raft) persist() {
	// Your code here.
	// Example:
	w := new(bytes.Buffer)
	e := gob.NewEncoder(w)
	e.Encode(rf.term)
	e.Encode(rf.voteTo)
	e.Encode(rf.log)
	data := w.Bytes()
	rf.persister.SaveRaftState(data)
}
&nbsp;
func (rf *Raft) readPersist(data []byte) {
	// Your code here.
	// Example:
	r := bytes.NewBuffer(data)
	d := gob.NewDecoder(r)
	d.Decode(&rf.term)
	d.Decode(&rf.voteTo)
	d.Decode(&rf.log)
}</code></pre>
<button class="copy-button" data-clipboard-target="#code6">Copy</button>
</div>
è¯¥éƒ¨åˆ†ä¸»è¦å®ç°çŠ¶æ€æ›´æ–°å’ŒæŒä¹…åŒ–ï¼Œéœ€è¦æŒä¹…åŒ–çš„æ•°æ®æœ‰ term ã€voteTo ã€log ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨ä»¥ä¸Šæ•°æ®å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œè¿›è¡ŒæŒä¹…åŒ–æ“ä½œå³å¯ï¼Œç”± persist å‡½æ•°å®ç°ï¼Œç›¸åº”çš„å¯¹ readPersist å®ç°è¯»å–å³å¯ã€‚å…·ä½“çš„ä½ç½®å·²ç»åœ¨å‰æ–‡ä¸­çš„ä»£ç ä¸­ä½“ç°ã€‚
<h4 id="é€šè¿‡æµ‹è¯•-2">é€šè¿‡æµ‹è¯•</h4>
<img src = "test3.png" alt = "æµ‹è¯•3" />
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è¿™æ¬¡å®éªŒï¼Œä¸€å¼€å§‹çœ‹äº†å…³äº Raft çš„è®ºæ–‡ä»¥åŠè®²è§£åŸç†çš„å°åŠ¨ç”»ï¼Œè§‰å¾— raft ä»åŸç†ä¸Šæ¥çœ‹è¿˜è›®ç®€å•çš„ï¼Œå±äºæ˜¯ç®€å•æ˜“æ‡‚ï¼Œä¾¿ä¸€ç›´æç½®ç€æ²¡æœ‰å¼€å§‹åšã€‚åé¢å…ˆæ˜¯å­¦äº†ä¸€äº›æœ‰å…³ go è¯­è¨€çš„è¯­æ³•ç­‰åŸºç¡€å†…å®¹ï¼Œç›´åˆ°ä» github ä¸‹è½½ä½œä¸šä»£ç ä¹‹å‰ï¼Œæˆ‘éƒ½æ²¡æƒ³åˆ°è¿™ä¸ªå®éªŒåŸæ¥æŒºéš¾çš„ã€‚ä»ä¸€å¼€å§‹è¯»ä»£ç æ¥çœ‹å…¶å®è¿˜å¥½ï¼Œéƒ½æ˜¯è®ºæ–‡é‡Œæåˆ°çš„å†…å®¹ä»¥åŠä¸€äº›åŸºç¡€æ¡†æ¶ï¼Œä½†æ˜¯çœŸæ­£å®ç°èµ·æ¥ï¼Œæ‰å‘ç°å…¶å®å­˜åœ¨å¾ˆå¤šé—®é¢˜ã€‚</p>
<p>èµ·åˆæˆ‘æƒ³çš„å¾ˆå¤æ‚ï¼Œä¼å›¾å°†æ‰€æœ‰çš„æƒ…å†µã€æ‰€æœ‰çš„æˆ‘é¢„æƒ³åˆ°çš„é—®é¢˜ä¸€å¼€å§‹ä¸€æ¬¡æ€§è§£å†³ï¼Œè¿™æ ·å¼€å±•èµ·æ¥æä¸ºå›°éš¾ï¼Œå¯¼è‡´æˆ‘è¿Ÿè¿Ÿå†³å®šä¸äº†å®ç°æ‰€ç”¨çš„ç»“æ„ä½“ä»¥åŠè¦ç”¨åˆ°çš„è¾…åŠ©å‡½æ•°ã€‚äºæ˜¯æˆ‘ç”¨å¦ä¸€ç§æ€è·¯ï¼ŒæŠŠè‡ªå·±å¸¦å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»ä¸€ä¸ª Follower å¼€å§‹æ¨¡æ‹Ÿè‡ªå·±é€‰ä¸¾çš„è¿‡ç¨‹ï¼Œå¹¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸€æ­¥ä¸€æ­¥ç»™è‡ªå·±é…å¤‡ç›¸åº”çš„æ•°æ®ç»“æ„ï¼Œå¹¶ç»™è‡ªå·±è®¾å®šå¯èƒ½çš„åˆ†æ”¯è·¯çº¿ã€‚é€šè¿‡è¿™ä¸ªæ–¹å¼å¯ä»¥å¿«é€Ÿæ‰“é€šä¸€ä¸ªåŸºç¡€çš„æµç¨‹ï¼Œä¹‹åå†å»å¯¹ä¸€äº›æƒ…å†µåšç»†èŠ‚çš„å±•å¼€ï¼Œè¿™æ ·å¤§å¤§åŠ é€Ÿäº†å®Œæˆçš„è¿‡ç¨‹ã€‚è®©æˆ‘æƒ³èµ·äº†é‚£å¥â€œå¿«é€Ÿæ‰“é€šæµç¨‹â€ï¼Œæ˜¯æœ‰å®é™…æ„ä¹‰çš„ã€‚</p>
<p>é€šè¿‡è¿™æ¬¡ Raft åè®®çš„ä»£ç å®ç°ï¼Œä¸ä»…æ·±å…¥ç†è§£äº†åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•çš„åŸç†å’Œæœºåˆ¶ï¼Œæ›´åœ¨å®è·µä¸­æå‡äº†è½¯ä»¶å¼€å‘çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬å¤æ‚æ•°æ®ç»“æ„çš„è®¾è®¡ä¸è¿ç”¨ã€ç½‘ç»œç¼–ç¨‹æŠ€å·§ã€å¹¶å‘æ§åˆ¶<del>ä»¥åŠæ€§èƒ½ä¼˜åŒ–</del>ç­‰æ–¹é¢ã€‚åŒæ—¶ï¼Œä¹Ÿæ·±åˆ»ä½“ä¼šåˆ°åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘ä¸­é¢ä¸´çš„è¯¸å¤šæŒ‘æˆ˜ï¼Œå¦‚ç½‘ç»œçš„ä¸ç¡®å®šæ€§ã€æ•°æ®ä¸€è‡´æ€§çš„ç»´æŠ¤ä»¥åŠæ€§èƒ½ç“¶é¢ˆçš„çªç ´ç­‰ã€‚</p>
<p>æ€»ä¹‹ï¼Œè¿™æ¬¡ Raft åè®®ä»£ç å®ç°æ˜¯ä¸€æ¬¡å……æ»¡æŒ‘æˆ˜ä½†æ”¶è·é¢‡ä¸°çš„å®è·µä¹‹æ—…ã€‚</p>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
    // åˆå§‹åŒ– Clipboard.js
    var clipboard = new ClipboardJS('.copy-button'); 
    clipboard.on('success', function(e) {
        var copyButton = e.trigger;
        copyButton.textContent = 'Copied!';
        copyButton.style.backgroundColor = '#cd3bee';
        setTimeout(function() {
            copyButton.textContent = 'Copy';
            copyButton.style.backgroundColor = '#008b8b';
        }, 2000);
        e.clearSelection();// æ¸…é™¤é€‰ä¸­çš„æ–‡æœ¬
    });
</script>
        </div>

        <div class="row middle-xs">
          <div class="col-xs-12">
            
          </div>
        </div>
        
          <div class="row">
            <div class="col-xs-12">
              
            </div>
          </div>

          



          
          
          <div style="height: 50px;"></div>
          
          <div class="post-comments">
            <div id="disqus_thread"></div>
<script>
  window.addEventListener("load", () => {
    (function() {
      
      var d = document,
        s = d.createElement("script");
      s.src = "https://dongi30.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  });
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>

          </div>
          
        

        <div class="site-footer">
  
  
</div>

      </div>
    </div>
  </article>

  

<script>
  
  
    
    
  
</script>

  

</body>

</html>